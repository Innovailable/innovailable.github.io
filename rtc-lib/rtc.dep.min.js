!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.rtc=t()}}(function(){var t;return function e(t,n,r){function i(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,c,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,c=new Array(i-1),a=1;i>a;a++)c[a-1]=arguments[a];n.apply(this,c)}else if(o(n)){for(i=arguments.length,c=new Array(i-1),a=1;i>a;a++)c[a-1]=arguments[a];for(u=n.slice(),i=u.length,a=0;i>a;a++)u[a].apply(this,c)}return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned){var i;i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,s,c;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(c=s;c-->0;)if(n[c]===e||n[c].listener&&n[c].listener===e){i=c;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?r(t._events[e])?1:t._events[e].length:0}},{}],2:[function(t,e){function n(){u=!1,s.length?a=s.concat(a):l=-1,a.length&&r()}function r(){if(!u){var t=setTimeout(n);u=!0;for(var e=a.length;e;){for(s=a,a=[];++l<e;)s&&s[l].run();l=-1,e=a.length}s=null,u=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function o(){}var s,c=e.exports={},a=[],u=!1,l=-1;c.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.push(new i(t,e)),1!==a.length||u||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=o,c.addListener=o,c.once=o,c.off=o,c.removeListener=o,c.removeAllListeners=o,c.emit=o,c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],3:[function(e,n){(function(r,i){(function(){"use strict";function o(t){return"function"==typeof t||"object"==typeof t&&null!==t}function s(t){return"function"==typeof t}function c(t){return"object"==typeof t&&null!==t}function a(t){Y=t}function u(t){Q=t}function l(){return function(){r.nextTick(_)}}function h(){return function(){V(_)}}function f(){var t=0,e=new $(_),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function p(){var t=new MessageChannel;return t.port1.onmessage=_,function(){t.port2.postMessage(0)}}function d(){return function(){setTimeout(_,1)}}function _(){for(var t=0;B>t;t+=2){var e=nt[t],n=nt[t+1];e(n),nt[t]=void 0,nt[t+1]=void 0}B=0}function m(){try{var t=e,n=t("vertx");return V=n.runOnLoop||n.runOnContext,h()}catch(r){return d()}}function v(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function w(t){try{return t.then}catch(e){return st.error=e,st}}function b(t,e,n,r){try{t.call(e,n,r)}catch(i){return i}}function E(t,e,n){Q(function(t){var r=!1,i=b(n,e,function(n){r||(r=!0,e!==n?P(t,n):T(t,n))},function(e){r||(r=!0,A(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,A(t,i))},t)}function S(t,e){e._state===it?T(t,e._result):e._state===ot?A(t,e._result):j(e,void 0,function(e){P(t,e)},function(e){A(t,e)})}function C(t,e){if(e.constructor===t.constructor)S(t,e);else{var n=w(e);n===st?A(t,st.error):void 0===n?T(t,e):s(n)?E(t,e,n):T(t,e)}}function P(t,e){t===e?A(t,g()):o(e)?C(t,e):T(t,e)}function L(t){t._onerror&&t._onerror(t._result),D(t)}function T(t,e){t._state===rt&&(t._result=e,t._state=it,0!==t._subscribers.length&&Q(D,t))}function A(t,e){t._state===rt&&(t._state=ot,t._result=e,Q(L,t))}function j(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+it]=n,i[o+ot]=r,0===o&&t._state&&Q(D,t)}function D(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,i,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?O(n,r,i,o):i(o);t._subscribers.length=0}}function k(){this.error=null}function M(t,e){try{return t(e)}catch(n){return ct.error=n,ct}}function O(t,e,n,r){var i,o,c,a,u=s(n);if(u){if(i=M(n,r),i===ct?(a=!0,o=i.error,i=null):c=!0,e===i)return void A(e,y())}else i=r,c=!0;e._state!==rt||(u&&c?P(e,i):a?A(e,o):t===it?T(e,i):t===ot&&A(e,i))}function U(t,e){try{e(function(e){P(t,e)},function(e){A(t,e)})}catch(n){A(t,n)}}function x(t,e){var n=this;n._instanceConstructor=t,n.promise=new t(v),n._validateInput(e)?(n._input=e,n.length=e.length,n._remaining=e.length,n._init(),0===n.length?T(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&T(n.promise,n._result))):A(n.promise,n._validationError())}function N(t){return new at(this,t).promise}function R(t){function e(t){P(i,t)}function n(t){A(i,t)}var r=this,i=new r(v);if(!K(t))return A(i,new TypeError("You must pass an array to race.")),i;for(var o=t.length,s=0;i._state===rt&&o>s;s++)j(r.resolve(t[s]),void 0,e,n);return i}function I(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(v);return P(n,t),n}function F(t){var e=this,n=new e(v);return A(n,t),n}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function W(t){this._id=pt++,this._state=void 0,this._result=void 0,this._subscribers=[],v!==t&&(s(t)||q(),this instanceof W||z(),U(this,t))}function G(){var t;if("undefined"!=typeof i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=dt)}var H;H=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var V,Y,J,K=H,B=0,Q=({}.toString,function(t,e){nt[B]=t,nt[B+1]=e,B+=2,2===B&&(Y?Y(_):J())}),X="undefined"!=typeof window?window:void 0,Z=X||{},$=Z.MutationObserver||Z.WebKitMutationObserver,tt="undefined"!=typeof r&&"[object process]"==={}.toString.call(r),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,nt=new Array(1e3);J=tt?l():$?f():et?p():void 0===X&&"function"==typeof e?m():d();var rt=void 0,it=1,ot=2,st=new k,ct=new k;x.prototype._validateInput=function(t){return K(t)},x.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},x.prototype._init=function(){this._result=new Array(this.length)};var at=x;x.prototype._enumerate=function(){for(var t=this,e=t.length,n=t.promise,r=t._input,i=0;n._state===rt&&e>i;i++)t._eachEntry(r[i],i)},x.prototype._eachEntry=function(t,e){var n=this,r=n._instanceConstructor;c(t)?t.constructor===r&&t._state!==rt?(t._onerror=null,n._settledAt(t._state,e,t._result)):n._willSettleAt(r.resolve(t),e):(n._remaining--,n._result[e]=t)},x.prototype._settledAt=function(t,e,n){var r=this,i=r.promise;i._state===rt&&(r._remaining--,t===ot?A(i,n):r._result[e]=n),0===r._remaining&&T(i,r._result)},x.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){n._settledAt(it,e,t)},function(t){n._settledAt(ot,e,t)})};var ut=N,lt=R,ht=I,ft=F,pt=0,dt=W;W.all=ut,W.race=lt,W.resolve=ht,W.reject=ft,W._setScheduler=a,W._setAsap=u,W._asap=Q,W.prototype={constructor:W,then:function(t,e){var n=this,r=n._state;if(r===it&&!t||r===ot&&!e)return this;var i=new this.constructor(v),o=n._result;if(r){var s=arguments[r-1];Q(function(){O(r,i,s,o)})}else j(n,i,t,e);return i},"catch":function(t){return this.then(null,t)}};var _t=G,mt={Promise:dt,polyfill:_t};"function"==typeof t&&t.amd?t(function(){return mt}):"undefined"!=typeof n&&n.exports?n.exports=mt:"undefined"!=typeof this&&(this.ES6Promise=mt),_t()}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],4:[function(t,e,n){(function(){var t,e;t=function(t,e){return null!=e?e.bind(t):void 0},n.compat=e={PeerConnection:window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,IceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate,SessionDescription:window.mozRTCSessionDescription||window.RTCSessionDescription,MediaStream:window.MediaStream||window.mozMediaStream||window.webkitMediaStream,getUserMedia:t(navigator,navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),supported:function(){return null!=e.PeerConnection&&null!=e.IceCandidate&&null!=e.SessionDescription&&null!=e.getUserMedia}}}).call(this)},{}],5:[function(t,e,n){(function(){var e,r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("./internal/promise"),e=o.Deferred,i=o.Promise,r=t("events").EventEmitter,n.DataChannel=function(t){function n(t,e){this.channel=t,this.max_buffer=null!=e?e:10240,this._connected=!1,this._connect_queue=[],this._send_buffer=[],this.channel.onmessage=function(t){return function(e){return t._connected?t.emit("message",e.data):t._connect_queue.push(e.data)}}(this),this.channel.onclose=function(t){return function(){return t.emit("closed")}}(this),this.channel.onerror=function(t){return function(e){return t.emit("error",e)}}(this)}return s(n,t),n.prototype.connect=function(){var t,e,n,r;for(this._connected=!0,r=this._connect_queue,e=0,n=r.length;n>e;e++)t=r[e],this.emit("message",t);return delete this._connect_queue,i.resolve()},n.prototype.label=function(){return this.channel.label},n.prototype.send=function(t){var n;return this._connected||(this.connect(),console.log("Sending without being connected. Please call connect() on the data channel to start using it.")),n=new e,this._send_buffer.push([t,n]),1===this._send_buffer.length&&this._actualSend(),n.promise},n.prototype._actualSend=function(){var t,e,n,r,i;if("open"!==this.channel.readyState){for(i=[];this._send_buffer.length;)r=this._send_buffer.shift(),t=r[0],e=r[1],i.push(e.reject(new Error("DataChannel closed")));return i}for(;this._send_buffer.length;){if(this.channel.bufferedAmount>=this.max_buffer)return void setTimeout(this._actualSend.bind(this),1);n=this._send_buffer[0],t=n[0],e=n[1];try{this.channel.send(t)}catch(o){return void setTimeout(this._actualSend.bind(this),1)}e.resolve(),this._send_buffer.shift()}},n}(r)}).call(this)},{"./internal/promise":7,events:1}],6:[function(t,e,n){(function(){var e,r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("./promise"),e=o.Deferred,i=o.Promise,r=t("events").EventEmitter,n.ChannelCollection=function(t){function n(){this.channels={},this.defers={},this.pending={},this.wait_d=new e,this.wait_p=this.wait_d.promise}return s(n,t),n.prototype.setLocal=function(t){return this.local=t,null!=this.remote?this._update():void 0},n.prototype.setRemote=function(t){return this.remote=t,null!=this.local?this._update():void 0},n.prototype._update=function(){var t,n,r,o,s;s=this.remote;for(o in s)n=s[o],null!=this.local[o]?null!=this.channels[o]||(null!=this.pending[o]?(t=this.pending[o],delete this.pending[o],this.channels[o]=i.resolve(t),this.emit("data_channel_added",o,this.channels[o])):(r=new e,this.channels[o]=r.promise,this.defers[o]=r,this.emit("data_channel_added",o,this.channels[o]))):console.log("DataChannel offered by remote but not by local");for(o in this.local)null==this.remote[o]&&console.log("DataChannel offered by local but not by remote");return this.wait_d.resolve()},n.prototype.resolve=function(t){var e;return e=t.label(),null!=this.defers[e]?(this.defers[e].resolve(t),delete this.defers[e]):this.pending[e]=t},n.prototype.get=function(t){return this.wait_p.then(function(e){return function(){if(null!=e.channels[t])return e.channels[t];throw new Error("DataChannel not negotiated")}}(this))},n}(r)}).call(this)},{"./promise":7,events:1}],7:[function(t,e,n){(function(e){(function(){n.Promise=e.Promise||t("es6-promise").Promise,n.Deferred=function(){function t(){this.promise=new n.Promise(function(t){return function(e,n){return t.resolve=e,t.reject=n}}(this))}return t}()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es6-promise":3}],8:[function(t,e,n){(function(){var e,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;e=t("./promise").Deferred,r=t("events").EventEmitter,n.StreamCollection=function(t){function n(){this.streams={},this._defers={},this._waiting={},this._pending={},this.wait_d=new e,this.wait_p=this.wait_d.promise}return i(n,t),n.prototype.update=function(t){var n,r,i,o,s,c,a,u,l;for(s=[],this._waiting={},a=this.streams,l=r=0,o=a.length;o>r;l=++r)c=a[l],null==t[c]&&(delete this.streams[c],this.emit("stream_removed",c),l.isFullfilled()?l.then(function(t){return t.close()}):l.isPending()&&l.reject(new Error("Stream removed before being established")));for(c in t)i=t[c],null==this.streams[c]&&(n=new e,this.streams[c]=n.promise,this._defers[c]=n,this.emit("stream_added",c,n.promise)),null!=this._defers[c]&&(null!=this._pending[i]?(u=this._pending[i],delete this._pending[i],this._defers[c].resolve(u),delete this._defers[c]):this._waiting[i]=c);return this.wait_d.resolve()},n.prototype.resolve=function(t){var e,n;return e=t.id(),null!=this._waiting[e]?(n=this._waiting[e],delete this._waiting[e],this._defers[n].resolve(t),delete this._defers[n]):this._pending[e]=t},n.prototype.get=function(t){return this.wait_p.then(function(e){return function(){if(null!=e.streams[t])return e.streams[t];throw new Error("Stream not offered")}}(this))},n}(r)}).call(this)},{"./promise":7,events:1}],9:[function(t,e){(function(){var n,r;r=function(t,e){var r,i;for(r in e)i=e[r],t[r]=i;return n},e.exports=n={internal:{},signaling:{}},r(n,t("./peer")),r(n,t("./remote_peer")),r(n,t("./local_peer")),r(n,t("./peer_connection")),r(n,t("./stream")),r(n,t("./compat")),r(n,t("./room")),r(n,t("./video_element")),r(n.internal,t("./internal/stream_collection")),r(n.internal,t("./internal/channel_collection")),r(n.internal,t("./internal/promise")),r(n.signaling,t("./signaling/web_socket_channel")),r(n.signaling,t("./signaling/palava_signaling"))}).call(this)},{"./compat":4,"./internal/channel_collection":6,"./internal/promise":7,"./internal/stream_collection":8,"./local_peer":10,"./peer":11,"./peer_connection":12,"./remote_peer":13,"./room":14,"./signaling/palava_signaling":16,"./signaling/web_socket_channel":18,"./stream":19,"./video_element":20}],10:[function(t,e,n){(function(){var e,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;e=t("./peer").Peer,r=t("./stream").Stream,n.LocalPeer=function(t){function e(){this.streams={},this.channels={},this._status={}}return i(e,t),e.prototype.status=function(t,e){return null==e?this._status[t]:(this._status[t]=e,void this.emit("status_changed",this._status))},e.prototype.addDataChannel=function(t,e){"string"!=typeof t&&(e=t,t=this.DEFAULT_CHANNEL),null==e&&(e={ordered:!0}),this.channels[t]=e,this.emit("configuration_changed")},e.prototype.addStream=function(t,e){var n,i;return n=function(e){return function(n){return e.streams[t]=n,e.emit("configuration_changed"),n}}(this),"string"!=typeof t&&(e=t,t=this.DEFAULT_STREAM),null!=(null!=e?e.then:void 0)?n(e):e instanceof r?n(Promise.resolve(e)):(i=r.createStream(e),n(i))},e.prototype.stream=function(t){return null==t&&(t=this.DEFAULT_STREAM),this.streams[t]},e}(e)}).call(this)},{"./peer":11,"./stream":19}],11:[function(t,e,n){(function(){var e,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=t("events").EventEmitter,n.Peer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.DEFAULT_CHANNEL="data",e.prototype.DEFAULT_STREAM="stream",e.prototype.status=function(){throw new Error("Not implemented")},e}(e)}).call(this)},{events:1}],12:[function(t,e,n){(function(){var e,r,i,o,s,c,a,u=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;a=t("./internal/promise"),r=a.Deferred,o=a.Promise,i=t("events").EventEmitter,s=t("./stream").Stream,e=t("./data_channel").DataChannel,c=t("./compat").compat,n.PeerConnection=function(t){function n(t,n){var i;this.offering=t,this.options=n,i=[],null!=this.options.stun&&i.push({url:this.options.stun}),this.pc=new c.PeerConnection({iceServers:i}),this.connect_d=new r,this.connected=!1,this.signaling_pending=[],this.pc.onicecandidate=function(t){return function(e){return t.emit("ice_candidate",e.candidate)}}(this),this.pc.onaddstream=function(t){return function(e){return t.emit("stream_added",new s(e.stream))}}(this),this.pc.ondatachannel=function(t){return function(n){return t.emit("data_channel_ready",new e(n.channel))}}(this),this.pc.onremovestream=function(){},this.pc.onnegotiationneeded=function(){return function(){return console.log("onnegotiationneeded called")}}(this),this.pc.oniceconnectionstatechange=function(t){return function(){var e;return"failed"===t.pc.iceConnectionState?t._connectError(new Error("Unable to establish ICE connection")):"closed"===t.pc.iceConnectionState?t.connect_d.reject(new Error("Connection was closed")):"connected"===(e=t.pc.iceConnectionState)||"completed"===e?t.connect_d.resolve():void 0}}(this),this.pc.onsignalingstatechange=function(){}}return u(n,t),n.prototype.signaling=function(t){var e;return e=new c.SessionDescription(t),this._setRemoteDescription(e).then(function(e){return function(){return"offer"===t.type&&e.connected?e._answer():void 0}}(this))["catch"](function(t){return function(e){return t._connectError(e)}}(this))},n.prototype.addIceCandidate=function(t){var e;return null!=t.candidate?(e=new c.IceCandidate(t),this.pc.addIceCandidate(e)):console.log("ICE trickling stopped")},n.prototype._oaOptions=function(){return{optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},n.prototype._setRemoteDescription=function(t){return new o(function(e){return function(n,r){var i;return i=new rtc.compat.SessionDescription(t),e.pc.setRemoteDescription(t,n,r)}}(this))},n.prototype._offer=function(){return new o(function(t){return function(e,n){return t.pc.createOffer(e,n,t._oaOptions())}}(this)).then(function(t){return function(e){return t._processLocalSdp(e)}}(this))["catch"](function(t){return function(e){return t._connectError(e)}}(this))},n.prototype._answer=function(){return new o(function(t){return function(e,n){return t.pc.createAnswer(e,n,t._oaOptions())}}(this)).then(function(t){return function(e){return t._processLocalSdp(e)}}(this))["catch"](function(t){return function(e){return t._connectError(e)}}(this))},n.prototype._processLocalSdp=function(t){return new o(function(e){return function(n,r){var i;return i=function(){var r;return r={sdp:t.sdp,type:t.type},e.emit("signaling",r),n(t)},e.pc.setLocalDescription(t,i,r)}}(this))},n.prototype._connectError=function(t){return this.connect_d.reject(t),console.log(t),this.emit("error",t)},n.prototype.addStream=function(t){return this.pc.addStream(t.stream)},n.prototype.removeSream=function(t){return this.pc.removeStream(t.stream)},n.prototype.addDataChannel=function(t,n){var r;return this.offering?(r=this.pc.createDataChannel(t,n),r.onopen=function(t){return function(){return t.emit("data_channel_ready",new e(r))}}(this)):void 0},n.prototype.connect=function(){return this.connected||(this.offering?this._offer():"have-remote-offer"===this.pc.signalingState&&this._answer(),this.connected=!0),this.connect_d.promise},n.prototype.close=function(){return this.pc.close(),this.emit("closed")},n}(i)}).call(this)},{"./compat":4,"./data_channel":5,"./internal/promise":7,"./stream":19,events:1}],13:[function(t,e,n){(function(){var e,r,i,o,s,c=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=t("./internal/promise").Promise,r=t("./peer").Peer,o=t("./internal/stream_collection").StreamCollection,e=t("./internal/channel_collection").ChannelCollection,s=function(){var t,e,n,r,i,o;for(i={},e=0,r=arguments.length;r>e;e++){t=arguments[e];for(n in t)o=t[n],i[n]=o}return i},n.RemotePeer=function(t){function n(t,n,r,i){this.peer_connection=t,this.signaling=n,this.local=r,this.options=i,this.private_streams={},this.private_channels={},this.stream_collection=new o,this.streams=this.stream_collection.streams,this.streams_desc={},this.stream_collection.on("stream_added",function(t){return function(e,n){return t.emit("stream_added",e,n)}}(this)),this.channel_collection=new e,this.channels=this.channel_collection.channels,this.channels_desc={},this.channel_collection.on("data_channel_added",function(t){return function(e,n){return t.emit("data_channel_added",e,n)}}(this)),this.peer_connection.on("stream_added",function(t){return function(e){return t.stream_collection.resolve(e)}}(this)),this.peer_connection.on("data_channel_ready",function(t){return function(e){return t.channel_collection.resolve(e)}}(this)),this.peer_connection.on("signaling",function(t){return function(e){return e.streams=t.streams_desc,e.channels=t.channels_desc,t.signaling.send("signaling",e)}}(this)),this.signaling.on("signaling",function(t){return function(e){return t.stream_collection.update(e.streams),t.channel_collection.setRemote(e.channels),t.peer_connection.signaling(e)}}(this)),this.peer_connection.on("ice_candidate",function(t){return function(e){return t.signaling.send("ice_candidate",e)}}(this)),this.signaling.on("ice_candidate",function(t){return function(e){return t.peer_connection.addIceCandidate(e)}}(this)),this.signaling.on("status_changed",function(t){return function(e){return t.emit("status_changed",e)}}(this)),this.signaling.on("message",function(t){return function(e){return t.emit("message",e)}}(this)),this.signaling.on("left",function(t){return function(){return t.peer_connection.close(),t.emit("left")}}(this)),this.peer_connection.on("connected",function(){return function(){}}(this)),this.peer_connection.on("closed",function(){return function(){}}(this)),(null==this.options.auto_connect||this.options.auto_connect)&&this.connect()}return c(n,t),n.prototype.status=function(t){return this.signaling.status[t]},n.prototype.message=function(t){return this.signaling.send("message",t)},n.prototype.connect=function(){var t,e,n,r,o;if(null==this.connect_p){o=[],n=s(this.local.streams,this.private_streams);for(t in n)r=n[t],e=r.then(function(e){return[t,e]}),o.push(e);this.connect_p=i.all(o).then(function(e){return function(n){var i,o,c,a,u;for(i=0,o=n.length;o>i;i++)a=n[i],t=a[0],r=a[1],e.peer_connection.addStream(r),e.streams_desc[t]=r.id();u=s(e.local.channels,e.private_channels);for(t in u)c=u[t],e.peer_connection.addDataChannel(t,c),e.channels_desc[t]=c;return e.channel_collection.setLocal(e.channels_desc),e.peer_connection.connect()}}(this))}return this.connect_p},n.prototype.close=function(){this.peer_connection.close()},n.prototype.stream=function(t){return null==t&&(t=this.DEFAULT_STREAM),this.stream_collection.get(t)},n.prototype.addStream=function(t,e){var n,r;return this.options.auto_connect!==!1?i.reject("Unable to add streams directly to remote peers without 'auto_connect' option set to 'false'"):(n=function(e){return function(n){return e.private_streams[t]=n,n}}(this),"string"!=typeof t&&(e=t,t=this.DEFAULT_STREAM),null!=(null!=e?e.then:void 0)?n(e):e instanceof Stream?n(i.resolve(e)):(r=Stream.createStream(e),n(r)))},n.prototype.channel=function(t){return null==t&&(t=this.DEFAULT_CHANNEL),this.channel_collection.get(t)},n.prototype.addDataChannel=function(t,e){return this.options.auto_connect!==!1?i.reject("Unable to add channels directly to remote peers without 'auto_connect' option set to 'false'"):("string"!=typeof t&&(e=t,t=this.DEFAULT_CHANNEL),null==e&&(e={ordered:!0}),this.private_channels[t]=e,this.channel(t))},n}(r)}).call(this)},{"./internal/channel_collection":6,"./internal/promise":7,"./internal/stream_collection":8,"./peer":11}],14:[function(t,e,n){(function(){var e,r,i,o,s,c,a=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e=t("events").EventEmitter,c=t("./signaling/web_socket_channel.coffee").WebSocketChannel,i=t("./signaling/muc_signaling.coffee").MucSignaling,s=t("./remote_peer.coffee").RemotePeer,r=t("./local_peer.coffee").LocalPeer,o=t("./peer_connection.coffee").PeerConnection,n.Room=function(t){function e(t,e){var n;this.signaling=t,this.options=null!=e?e:{},("string"==typeof this.signaling||this.signaling instanceof String)&&(n=new c(this.signaling),this.signaling=new i(n)),this.local=this.options.local||new r,this.signaling.on("peer_joined",function(t){return function(e){var n,r;return n=new o(e.first,t.options),r=new s(n,e,t.local,t.options),t.peers[e.id]=r,t.emit("peer_joined",r),r.on("closed",function(){return delete t.peers[e.id]})}}(this)),this.peers={}}return a(e,t),e.prototype.connect=function(){return null==this.join_p&&(this.join_p=this.signaling.connect()),this.join_p},e.prototype.leave=function(){return this.signaling.leave()},e.prototype.destroy=function(){return this.signaling.leave()},e}(e)}).call(this)},{"./local_peer.coffee":10,"./peer_connection.coffee":12,"./remote_peer.coffee":13,"./signaling/muc_signaling.coffee":15,"./signaling/web_socket_channel.coffee":18,events:1}],15:[function(t,e,n){(function(){var e,r,i,o,s,c=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;e=t("../internal/promise").Deferred,s=t("./signaling"),i=s.Signaling,o=s.SignalingPeer,r=t("events").EventEmitter,n.MucSignalingPeer=function(t){function e(t,e,n,r){var i;this.channel=t,this.peer_id=e,this.status=n,this.first=r,i=function(t){return function(e){if(e.peer===t.peer_id&&null!=e.type)switch(e.type){case"from":if(null==e.event||null==e.data)return;return t.emit(e.event,e.data);case"peer_left":return t.emit("left"),t.channel.removeListener("message",i);case"peer_status":return t.status=e.status,t.emit("status_changed",t.status)}}}(this),this.channel.on("message",i)}return c(e,t),e.prototype.send=function(t,e){return null==e&&(e={}),this.channel.send({type:"to",peer:this.peer_id,event:t,data:e})},e}(o),n.MucSignaling=function(t){function r(t){var r;this.channel=t,this.status={},r=new e,this.join_p=r.promise,this.channel.on("closed",function(t){return function(){return t.emit("closed")}}(this)),this.channel.on("message",function(t){return function(e){var i,o,s,c;if(null!=e.type)switch(e.type){case"joined":if(null==e.peers)return;s=e.peers;for(o in s)c=s[o],i=new n.MucSignalingPeer(t.channel,o,c,!1),t.emit("peer_joined",i);return r.resolve();case"peer_joined":if(null==e.peer)return;return i=new n.MucSignalingPeer(t.channel,e.peer,e.status,!0),t.emit("peer_joined",i)}}}(this))}return c(r,t),r.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=this.channel.connect().then(function(t){return function(){return t.channel.send({type:"join",status:t.status})}}(this)).then(function(t){return function(){return t.join_d}}(this))),this.connect_p},r.prototype.setStatus=function(t){return this.status=t,this.connect_p?this.connect_p.then(function(){return this.channel.send({type:"status",status:t})}):void 0},r.prototype.leave=function(){return this.channel.send({type:"leave"}).then(function(){return this.channel.close()})},r}(i)}).call(this)},{"../internal/promise":7,"./signaling":17,events:1}],16:[function(t,e,n){(function(){var e,r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;

e=t("../internal/promise").Deferred,o=t("./signaling"),r=o.Signaling,i=o.SignalingPeer,n.PalavaSignalingPeer=function(t){function e(t,e,n,r){var i;this.channel=t,this.id=e,this.status=n,this.first=r,i=function(t){return function(e){return e.sender_id===t.id?null==e.event?void t.send("error","Invalid message"):t.emit(e.event,e.data):void 0}}(this),this.channel.on("message",i),this.on("peer_updated_status",function(t){return function(e){return t.emit("status_changed",e)}}(this)),this.on("peer_left",function(t){return function(){return t.emit("closed"),t.channel.removeListener("message",i)}}(this))}return s(e,t),e.prototype.send=function(t,e){return null==e&&(e={}),this.channel.send({event:"send_to_peer",peer_id:this.id,data:{event:t,data:e}})},e}(i),n.PalavaSignaling=function(t){function r(t,r,i){var o;this.channel=t,this.room=r,this.status=i,this.peers={},this.joined=!1,o=new e,this.join_p=o.promise,this.channel.on("closed",function(t){return function(){return t.emit("closed")}}(this)),this.channel.on("message",function(t){return function(e){var r,i,s;if(null!=e.event)switch(e.event){case"joined_room":if(null==e.peers||null==e.own_id)return;s=e.peers;for(r in s)e=s[r],i=new n.PalavaSignalingPeer(t.channel,e.peer_id,e.status,!1),t.peers[e.peer_id]=i,t.emit("peer_joined",i);return o.resolve();case"new_peer":if(null==e.peer_id)return;return i=new n.PalavaSignalingPeer(t.channel,e.peer_id,e.status,!0),t.peers[e.peer]=i,t.emit("peer_joined",i)}}}(this))}return s(r,t),r.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=this.channel.connect().then(function(t){return function(){return t.channel.send({event:"join_room",room_id:room,status:status})}}(this))),this.connect_p},r.prototype.set_status=function(t){return this.channel.send({event:"update_status",status:t})},r.prototype.leave=function(){return this.channel.close()},r}(r)}).call(this)},{"../internal/promise":7,"./signaling":17}],17:[function(t,e,n){(function(){var e,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=t("events").EventEmitter,n.Signaling=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.connect=function(){throw new Error("Not implemented")},e.prototype.close=function(){throw new Error("Not implemented")},e.prototype.setStatus=function(){throw new Error("Not implemented")},e}(e),n.SignalingPeer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.send=function(t,e){throw null==e&&(e={}),new Error("Not implemented")},e}(e),n.Channel=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.connect=function(){throw new Error("Not implemented")},e.prototype.send=function(){throw new Error("Not implemented")},e.prototype.close=function(){throw new Error("Not implemented")},e}(e)}).call(this)},{events:1}],18:[function(t,e,n){(function(){var e,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty,s=[].slice;r=t("../internal/promise").Promise,e=t("./signaling").Channel,n.WebSocketChannel=function(t){function e(){var t,e,n,r,i;if(t=arguments[0],i=2<=arguments.length?s.call(arguments,1):[],this.address=t,i.length>0){for(;this.address.endsWith("/");)this.address=this.address.substr(0,this.address.length-1);for(e=0,n=i.length;n>e;e++)r=i[e],this.address+="/"+encodeUriComponent(r)}}return i(e,t),e.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=new r(function(t){return function(e,n){var r;return r=new WebSocket(t.address),r.onopen=function(){return t.socket=r,e()},r.onerror=function(e){return delete t.socket,t.emit("error",e),n(new Error("Unable to connect to socket"))},r.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(r){return void t.emit("error","Unable to parse incoming message")}return t.emit("message",n)},r.onclose=function(){return t.emit("closed")}}}(this))),this.connect_p},e.prototype.send=function(t){var e;if(null==this.socket)return r.reject(new Error("Trying to send on WebSocket without being connected"));try{return this.socket.send(JSON.stringify(t)),r.resolve()}catch(n){return e=n,r.reject(e)}},e.prototype.close=function(){var t;if(null==this.socket)return r.reject(new Error("Trying to close WebSocket without being connected"));try{return this.socket.close(),r.resolve()}catch(e){return t=e,r.reject(t)}},e}(e)}).call(this)},{"../internal/promise":7,"./signaling":17}],19:[function(t,e,n){(function(){var e;e=t("./compat").compat,n.Stream=function(){function t(t){this.stream=t}return t.prototype.id=function(){return this.stream.id},t.prototype.hasTracks=function(t){return this.getTracks(t).length},t.prototype.getTracks=function(t){if(t=t.toLowerCase(),"audio"===t)return this.stream_p.then(function(t){return t.getAudioTracks()});if("video"===t)return this.stream_p.then(function(t){return t.getVideoTracks()});if("both"===t)return this.stream_p.then(function(t){var e,n;return n=t.getVideoTracks(),e=t.getAudioTracks(),n.concat(audio)});throw new Error("Invalid stream part '"+t+"'")},t.prototype.mute=function(t,e){var n,r,i,o;for(null==t&&(t=!0),null==e&&(e="audio"),i=getTracks(e),n=0,r=i.length;r>n;n++)o=i[n],o.enabled=!t;return t},t.prototype.toggleMute=function(t){var e,n,r,i,o,s;for(null==t&&(t="audio"),s=getTracks(t),r=!(null!=(i=s[0])?i.enabled:void 0),e=0,n=s.length;n>e;e++)o=s[e],o.enabled=!r;return r},t.prototype.stop=function(){return stream.stop()},t.createStream=function(n){return null==n&&(n={audio:!0,video:!0}),new Promise(function(r,i){var o;return o=function(e){return r(new t(e))},e.getUserMedia(n,o,i)})},t}()}).call(this)},{"./compat":4}],20:[function(t,e,n){(function(){var e,r;r=t("./stream").Stream,e=t("./peer").Peer,n.MediaDomElement=function(){function t(t,e){this.dom=t,null!=this.dom.jquery&&(this.dom=this.dom[0]),this.attach(e)}return t.prototype.attach=function(t){return null==t?(delete this.stream,this.dom.pause(),this.dom.src=null):t instanceof r?(this.stream=t,"undefined"!=typeof mozGetUserMedia&&null!==mozGetUserMedia?this.dom.mozSrcObject=t.stream:this.dom.src=URL.createObjectURL(t.stream),this.dom.play()):t instanceof e?this.attach(t.stream()):null!=(null!=t?t.then:void 0)?t.then(function(t){return function(e){return t.attach(e)}}(this))["catch"](function(t){return function(e){return t.error(e)}}(this)):this.error("Tried to attach invalid data")},t.prototype.error=function(t){return console.log(t)},t.prototype.clear=function(){return this.attach()},t.prototype.mute=function(t){return null==t&&(t=!0),this.dom.muted=t},t.prototype.toggleMute=function(){return this.dom.muted=!this.dom.muted},t}()}).call(this)},{"./peer":11,"./stream":19}]},{},[9])(9)});