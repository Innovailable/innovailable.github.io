!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.rtc=t()}}(function(){var t;return function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,u,c,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,u=new Array(i-1),c=1;i>c;c++)u[c-1]=arguments[c];n.apply(this,u)}else if(o(n)){for(i=arguments.length,u=new Array(i-1),c=1;i>c;c++)u[c-1]=arguments[c];for(a=n.slice(),i=a.length,c=0;i>c;c++)a[c].apply(this,u)}return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned){var i;i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,s,u;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(u=s;u-->0;)if(n[u]===e||n[u].listener&&n[u].listener===e){i=u;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?r(t._events[e])?1:t._events[e].length:0}},{}],2:[function(t,e){function n(){a=!1,s.length?c=s.concat(c):l=-1,c.length&&r()}function r(){if(!a){var t=setTimeout(n);a=!0;for(var e=c.length;e;){for(s=c,c=[];++l<e;)s&&s[l].run();l=-1,e=c.length}s=null,a=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function o(){}var s,u=e.exports={},c=[],a=!1,l=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new i(t,e)),1!==c.length||a||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=o,u.addListener=o,u.once=o,u.off=o,u.removeListener=o,u.removeAllListeners=o,u.emit=o,u.binding=function(){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],3:[function(e,n){(function(r,i){(function(){"use strict";function o(t){return"function"==typeof t||"object"==typeof t&&null!==t}function s(t){return"function"==typeof t}function u(t){return"object"==typeof t&&null!==t}function c(t){V=t}function a(t){Q=t}function l(){return function(){r.nextTick(m)}}function h(){return function(){Y(m)}}function p(){var t=0,e=new $(m),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function f(){var t=new MessageChannel;return t.port1.onmessage=m,function(){t.port2.postMessage(0)}}function d(){return function(){setTimeout(m,1)}}function m(){for(var t=0;B>t;t+=2){var e=nt[t],n=nt[t+1];e(n),nt[t]=void 0,nt[t+1]=void 0}B=0}function _(){try{var t=e,n=t("vertx");return Y=n.runOnLoop||n.runOnContext,h()}catch(r){return d()}}function g(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function w(t){try{return t.then}catch(e){return st.error=e,st}}function b(t,e,n,r){try{t.call(e,n,r)}catch(i){return i}}function E(t,e,n){Q(function(t){var r=!1,i=b(n,e,function(n){r||(r=!0,e!==n?C(t,n):j(t,n))},function(e){r||(r=!0,T(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,T(t,i))},t)}function S(t,e){e._state===it?j(t,e._result):e._state===ot?T(t,e._result):k(e,void 0,function(e){C(t,e)},function(e){T(t,e)})}function P(t,e){if(e.constructor===t.constructor)S(t,e);else{var n=w(e);n===st?T(t,st.error):void 0===n?j(t,e):s(n)?E(t,e,n):j(t,e)}}function C(t,e){t===e?T(t,v()):o(e)?P(t,e):j(t,e)}function L(t){t._onerror&&t._onerror(t._result),A(t)}function j(t,e){t._state===rt&&(t._result=e,t._state=it,0!==t._subscribers.length&&Q(A,t))}function T(t,e){t._state===rt&&(t._state=ot,t._result=e,Q(L,t))}function k(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+it]=n,i[o+ot]=r,0===o&&t._state&&Q(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,i,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?O(n,r,i,o):i(o);t._subscribers.length=0}}function D(){this.error=null}function I(t,e){try{return t(e)}catch(n){return ut.error=n,ut}}function O(t,e,n,r){var i,o,u,c,a=s(n);if(a){if(i=I(n,r),i===ut?(c=!0,o=i.error,i=null):u=!0,e===i)return void T(e,y())}else i=r,u=!0;e._state!==rt||(a&&u?C(e,i):c?T(e,o):t===it?j(e,i):t===ot&&T(e,i))}function U(t,e){try{e(function(e){C(t,e)},function(e){T(t,e)})}catch(n){T(t,n)}}function x(t,e){var n=this;n._instanceConstructor=t,n.promise=new t(g),n._validateInput(e)?(n._input=e,n.length=e.length,n._remaining=e.length,n._init(),0===n.length?j(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&j(n.promise,n._result))):T(n.promise,n._validationError())}function M(t){return new ct(this,t).promise}function R(t){function e(t){C(i,t)}function n(t){T(i,t)}var r=this,i=new r(g);if(!K(t))return T(i,new TypeError("You must pass an array to race.")),i;for(var o=t.length,s=0;i._state===rt&&o>s;s++)k(r.resolve(t[s]),void 0,e,n);return i}function q(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(g);return C(n,t),n}function N(t){var e=this,n=new e(g);return T(n,t),n}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function W(t){this._id=ft++,this._state=void 0,this._result=void 0,this._subscribers=[],g!==t&&(s(t)||F(),this instanceof W||z(),U(this,t))}function G(){var t;if("undefined"!=typeof i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(t.Promise=dt)}var H;H=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var Y,V,J,K=H,B=0,Q=({}.toString,function(t,e){nt[B]=t,nt[B+1]=e,B+=2,2===B&&(V?V(m):J())}),X="undefined"!=typeof window?window:void 0,Z=X||{},$=Z.MutationObserver||Z.WebKitMutationObserver,tt="undefined"!=typeof r&&"[object process]"==={}.toString.call(r),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,nt=new Array(1e3);J=tt?l():$?p():et?f():void 0===X&&"function"==typeof e?_():d();var rt=void 0,it=1,ot=2,st=new D,ut=new D;x.prototype._validateInput=function(t){return K(t)},x.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},x.prototype._init=function(){this._result=new Array(this.length)};var ct=x;x.prototype._enumerate=function(){for(var t=this,e=t.length,n=t.promise,r=t._input,i=0;n._state===rt&&e>i;i++)t._eachEntry(r[i],i)},x.prototype._eachEntry=function(t,e){var n=this,r=n._instanceConstructor;u(t)?t.constructor===r&&t._state!==rt?(t._onerror=null,n._settledAt(t._state,e,t._result)):n._willSettleAt(r.resolve(t),e):(n._remaining--,n._result[e]=t)},x.prototype._settledAt=function(t,e,n){var r=this,i=r.promise;i._state===rt&&(r._remaining--,t===ot?T(i,n):r._result[e]=n),0===r._remaining&&j(i,r._result)},x.prototype._willSettleAt=function(t,e){var n=this;k(t,void 0,function(t){n._settledAt(it,e,t)},function(t){n._settledAt(ot,e,t)})};var at=M,lt=R,ht=q,pt=N,ft=0,dt=W;W.all=at,W.race=lt,W.resolve=ht,W.reject=pt,W._setScheduler=c,W._setAsap=a,W._asap=Q,W.prototype={constructor:W,then:function(t,e){var n=this,r=n._state;if(r===it&&!t||r===ot&&!e)return this;var i=new this.constructor(g),o=n._result;if(r){var s=arguments[r-1];Q(function(){O(r,i,s,o)})}else k(n,i,t,e);return i},"catch":function(t){return this.then(null,t)}};var mt=G,_t={Promise:dt,polyfill:mt};"function"==typeof t&&t.amd?t(function(){return _t}):"undefined"!=typeof n&&n.exports?n.exports=_t:"undefined"!=typeof this&&(this.ES6Promise=_t),mt()}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],4:[function(t,e){"use strict";var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===r.call(t)},o=function(t){if(!t||"[object Object]"!==r.call(t))return!1;var e=n.call(t,"constructor"),i=t.constructor&&t.constructor.prototype&&n.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!i)return!1;var o;for(o in t);return"undefined"==typeof o||n.call(t,o)};e.exports=function s(){var t,e,n,r,u,c,a=arguments[0],l=1,h=arguments.length,p=!1;for("boolean"==typeof a?(p=a,a=arguments[1]||{},l=2):("object"!=typeof a&&"function"!=typeof a||null==a)&&(a={});h>l;++l)if(t=arguments[l],null!=t)for(e in t)n=a[e],r=t[e],a!==r&&(p&&r&&(o(r)||(u=i(r)))?(u?(u=!1,c=n&&i(n)?n:[]):c=n&&o(n)?n:{},a[e]=s(p,c,r)):"undefined"!=typeof r&&(a[e]=r));return a}},{}],5:[function(t,e,n){(function(){var t,e;t=function(t,e){return null!=e?e.bind(t):void 0},n.compat=e={PeerConnection:window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,IceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate,SessionDescription:window.mozRTCSessionDescription||window.RTCSessionDescription,MediaStream:window.MediaStream||window.mozMediaStream||window.webkitMediaStream,getUserMedia:t(navigator,navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),supported:function(){return null!=e.PeerConnection&&null!=e.IceCandidate&&null!=e.SessionDescription&&null!=e.getUserMedia}}}).call(this)},{}],6:[function(t,e,n){(function(){var e,r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=t("./internal/promise"),e=o.Deferred,i=o.Promise,r=t("events").EventEmitter,n.DataChannel=function(t){function n(t,e){this.channel=t,this.max_buffer=null!=e?e:10240,this._connected=!1,this._connect_queue=[],this._send_buffer=[],this.channel.onmessage=function(t){return function(e){return t._connected?t.emit("message",e.data):t._connect_queue.push(e.data)}}(this),this.channel.onclose=function(t){return function(){return t.emit("closed")}}(this),this.channel.onerror=function(t){return function(e){return t.emit("error",e)}}(this)}return s(n,t),n.prototype.connect=function(){var t,e,n,r;for(this._connected=!0,r=this._connect_queue,e=0,n=r.length;n>e;e++)t=r[e],this.emit("message",t);return delete this._connect_queue,i.resolve()},n.prototype.close=function(){return this.channel.close(),i.resolve()},n.prototype.label=function(){return this.channel.label},n.prototype.send=function(t){var n;return this._connected||(this.connect(),console.log("Sending without being connected. Please call connect() on the data channel to start using it.")),n=new e,this._send_buffer.push([t,n]),1===this._send_buffer.length&&this._actualSend(),n.promise},n.prototype._actualSend=function(){var t,e,n,r,i;if("open"!==this.channel.readyState){for(i=[];this._send_buffer.length;)r=this._send_buffer.shift(),t=r[0],e=r[1],i.push(e.reject(new Error("DataChannel closed")));return i}for(;this._send_buffer.length;){if(this.channel.bufferedAmount>=this.max_buffer)return void setTimeout(this._actualSend.bind(this),1);n=this._send_buffer[0],t=n[0],e=n[1];try{this.channel.send(t)}catch(o){return void setTimeout(this._actualSend.bind(this),1)}e.resolve(),this._send_buffer.shift()}},n}(r)}).call(this)},{"./internal/promise":8,events:1}],7:[function(t,e,n){(function(){var e,r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=t("./promise"),e=o.Deferred,i=o.Promise,r=t("events").EventEmitter,n.ChannelCollection=function(t){function n(){this.channels={},this.defers={},this.pending={},this.wait_d=new e,this.wait_p=this.wait_d.promise}return s(n,t),n.prototype.setLocal=function(t){return this.local=t,null!=this.remote?this._update():void 0},n.prototype.setRemote=function(t){return this.remote=t,null!=this.local?this._update():void 0},n.prototype._update=function(){var t,n,r,o,s;s=this.remote;for(o in s)n=s[o],null!=this.local[o]?null!=this.channels[o]||(null!=this.pending[o]?(t=this.pending[o],delete this.pending[o],this.channels[o]=i.resolve(t),this.emit("data_channel_added",o,this.channels[o])):(r=new e,this.channels[o]=r.promise,this.defers[o]=r,this.emit("data_channel_added",o,this.channels[o]))):console.log("DataChannel offered by remote but not by local");for(o in this.local)null==this.remote[o]&&console.log("DataChannel offered by local but not by remote");return this.wait_d.resolve()},n.prototype.resolve=function(t){var e;return e=t.label(),null!=this.defers[e]?(this.defers[e].resolve(t),delete this.defers[e]):this.pending[e]=t},n.prototype.get=function(t){return this.wait_p.then(function(e){return function(){if(null!=e.channels[t])return e.channels[t];throw new Error("DataChannel not negotiated")}}(this))},n}(r)}).call(this)},{"./promise":8,events:1}],8:[function(t,e,n){(function(e){(function(){n.Promise=e.Promise||t("es6-promise").Promise,n.Deferred=function(){function t(){this.promise=new n.Promise(function(t){return function(e,n){return t.resolve=e,t.reject=n}}(this))}return t}(),n.timeout=function(t,e){return new Promise(function(n,r){return t.then(n,r),setTimeout(function(){return r(new Error("Operation timed out"))},e)})}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es6-promise":3}],9:[function(t,e,n){(function(){var e,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;e=t("./promise").Deferred,r=t("events").EventEmitter,n.StreamCollection=function(t){function n(){this.streams={},this._defers={},this._waiting={},this._pending={},this.wait_d=new e,this.wait_p=this.wait_d.promise}return i(n,t),n.prototype.update=function(t){var n,r,i,o,s,u,c,a,l;for(s=[],this._waiting={},c=this.streams,l=r=0,o=c.length;o>r;l=++r)u=c[l],null==t[u]&&(delete this.streams[u],this.emit("stream_removed",u),l.isFullfilled()?l.then(function(t){return t.close()}):l.isPending()&&l.reject(new Error("Stream removed before being established")));for(u in t)i=t[u],null==this.streams[u]&&(n=new e,this.streams[u]=n.promise,this._defers[u]=n,this.emit("stream_added",u,n.promise)),null!=this._defers[u]&&(null!=this._pending[i]?(a=this._pending[i],delete this._pending[i],this._defers[u].resolve(a),delete this._defers[u]):this._waiting[i]=u);return this.wait_d.resolve()},n.prototype.resolve=function(t){var e,n;return e=t.id(),"default"===e&&(1===Object.keys(this.streams).length&&1===Object.keys(this._waiting).length?(console.log("Working around incompatibility between Firefox and Chrome concerning stream identification"),e=Object.keys(this._waiting)[0]):console.log("Unable to work around incompatibility between Firefox and Chrome concerning stream identification")),null!=this._waiting[e]?(n=this._waiting[e],delete this._waiting[e],this._defers[n].resolve(t),delete this._defers[n]):this._pending[e]=t},n.prototype.get=function(t){return this.wait_p.then(function(e){return function(){if(null!=e.streams[t])return e.streams[t];throw new Error("Stream not offered")}}(this))},n}(r)}).call(this)},{"./promise":8,events:1}],10:[function(t,e){(function(){var n,r;r=function(t,e){var r,i;for(r in e)i=e[r],t[r]=i;return n},e.exports=n={internal:{},signaling:{}},r(n,t("./peer")),r(n,t("./remote_peer")),r(n,t("./local_peer")),r(n,t("./peer_connection")),r(n,t("./stream")),r(n,t("./compat")),r(n,t("./room")),r(n,t("./video_element")),r(n.internal,t("./internal/stream_collection")),r(n.internal,t("./internal/channel_collection")),r(n.internal,t("./internal/promise")),r(n.signaling,t("./signaling/web_socket_channel")),r(n.signaling,t("./signaling/palava_signaling")),r(n.signaling,t("./signaling/calling_signaling")),r(n.signaling,t("./signaling/muc_signaling"))}).call(this)},{"./compat":5,"./internal/channel_collection":7,"./internal/promise":8,"./internal/stream_collection":9,"./local_peer":11,"./peer":12,"./peer_connection":13,"./remote_peer":14,"./room":15,"./signaling/calling_signaling":16,"./signaling/muc_signaling":17,"./signaling/palava_signaling":18,"./signaling/web_socket_channel":20,"./stream":21,"./video_element":22}],11:[function(t,e,n){(function(){var e,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;e=t("./peer").Peer,r=t("./stream").Stream,n.LocalPeer=function(t){function e(){this.streams={},this.channels={},this._status={}}return i(e,t),e.prototype.status=function(t,e){return null==e?this._status[t]:(this._status[t]=e,void this.emit("status_changed",this._status))},e.prototype.addDataChannel=function(t,e){"string"!=typeof t&&(e=t,t=this.DEFAULT_CHANNEL),null==e&&(e={ordered:!0}),this.channels[t]=e,this.emit("configuration_changed")},e.prototype.addStream=function(t,e){var n,i;return n=function(e){return function(n){return e.streams[t]=n,e.emit("configuration_changed"),n}}(this),"string"!=typeof t&&(e=t,t=this.DEFAULT_STREAM),null!=(null!=e?e.then:void 0)?n(e):e instanceof r?n(Promise.resolve(e)):(i=r.createStream(e),n(i))},e.prototype.stream=function(t){return null==t&&(t=this.DEFAULT_STREAM),this.streams[t]},e.prototype.isLocal=function(){return!0},e}(e)}).call(this)},{"./peer":12,"./stream":21}],12:[function(t,e,n){(function(){var e,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=t("events").EventEmitter,n.Peer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.DEFAULT_CHANNEL="data",e.prototype.DEFAULT_STREAM="stream",e.prototype.status=function(){throw new Error("Not implemented")},e}(e)}).call(this)},{events:1}],13:[function(t,e,n){(function(){var e,r,i,o,s,u,c,a=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;c=t("./internal/promise"),r=c.Deferred,o=c.Promise,i=t("events").EventEmitter,s=t("./stream").Stream,e=t("./data_channel").DataChannel,u=t("./compat").compat,n.PeerConnection=function(t){function n(t,n){var i;this.offering=t,this.options=n,i=[],this.no_gc_bugfix=[],null!=this.options.stun&&i.push({url:this.options.stun}),this.pc=new u.PeerConnection({iceServers:i}),this.connect_d=new r,this.connected=!1,this.connect_d.promise["catch"](function(){}),this.signaling_pending=[],this.pc.onicecandidate=function(t){return function(e){return t.emit("ice_candidate",e.candidate)}}(this),this.pc.onaddstream=function(t){return function(e){return t.emit("stream_added",new s(e.stream))}}(this),this.pc.ondatachannel=function(t){return function(n){return t.emit("data_channel_ready",new e(n.channel))}}(this),this.pc.onremovestream=function(){},this.pc.onnegotiationneeded=function(){return function(){return console.log("onnegotiationneeded called")}}(this),this.pc.oniceconnectionstatechange=function(t){return function(){var e;return"failed"===t.pc.iceConnectionState?t._connectError(new Error("Unable to establish ICE connection")):"closed"===t.pc.iceConnectionState?t.connect_d.reject(new Error("Connection was closed")):"connected"===(e=t.pc.iceConnectionState)||"completed"===e?t.connect_d.resolve():void 0}}(this),this.pc.onsignalingstatechange=function(){}}return a(n,t),n.prototype.signaling=function(t){var e;return e=new u.SessionDescription(t),this._setRemoteDescription(e).then(function(e){return function(){return"offer"===t.type&&e.connected?e._answer():void 0}}(this))["catch"](function(t){return function(e){return t._connectError(e)}}(this))},n.prototype.addIceCandidate=function(t){var e;return null!=(null!=t?t.candidate:void 0)?(e=new u.IceCandidate(t),this.pc.addIceCandidate(e)):console.log("ICE trickling stopped")},n.prototype._oaOptions=function(){return{optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},n.prototype._setRemoteDescription=function(t){return new o(function(e){return function(n,r){var i;return i=new u.SessionDescription(t),e.pc.setRemoteDescription(t,n,r)}}(this))},n.prototype._offer=function(){return new o(function(t){return function(e,n){return t.pc.createOffer(e,n,t._oaOptions())}}(this)).then(function(t){return function(e){return t._processLocalSdp(e)}}(this))["catch"](function(t){return function(e){return t._connectError(e)}}(this))},n.prototype._answer=function(){return new o(function(t){return function(e,n){return t.pc.createAnswer(e,n,t._oaOptions())}}(this)).then(function(t){return function(e){return t._processLocalSdp(e)}}(this))["catch"](function(t){return function(e){return t._connectError(e)}}(this))},n.prototype._processLocalSdp=function(t){return new o(function(e){return function(n,r){var i;return i=function(){var r;return r={sdp:t.sdp,type:t.type},e.emit("signaling",r),n(t)},e.pc.setLocalDescription(t,i,r)}}(this))},n.prototype._connectError=function(t){return this.connect_d.reject(t),console.log(t),this.emit("error",t)},n.prototype.addStream=function(t){return this.pc.addStream(t.stream)},n.prototype.removeSream=function(t){return this.pc.removeStream(t.stream)},n.prototype.addDataChannel=function(t,n){var r;return this.offering?(r=this.pc.createDataChannel(t,n),this.no_gc_bugfix.push(r),r.onopen=function(t){return function(){return t.emit("data_channel_ready",new e(r))}}(this)):void 0},n.prototype.connect=function(){return this.connected||(this.offering?this._offer():"have-remote-offer"===this.pc.signalingState&&this._answer(),this.connected=!0),o.resolve(this.connect_d.promise)},n.prototype.close=function(){return this.pc.close(),this.emit("closed")},n}(i)}).call(this)},{"./compat":5,"./data_channel":6,"./internal/promise":8,"./stream":21,events:1}],14:[function(t,e,n){(function(){var e,r,i,o,s,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;i=t("./internal/promise").Promise,r=t("./peer").Peer,o=t("./internal/stream_collection").StreamCollection,e=t("./internal/channel_collection").ChannelCollection,s=function(){var t,e,n,r,i,o;for(i={},e=0,r=arguments.length;r>e;e++){t=arguments[e];for(n in t)o=t[n],i[n]=o}return i},n.RemotePeer=function(t){function n(t,n,r,i){this.peer_connection=t,this.signaling=n,this.local=r,this.options=i,this.private_streams={},this.private_channels={},this.stream_collection=new o,this.streams=this.stream_collection.streams,this.streams_desc={},this.stream_collection.on("stream_added",function(t){return function(e,n){return t.emit("stream_added",e,n)}}(this)),this.channel_collection=new e,this.channels=this.channel_collection.channels,this.channels_desc={},this.channel_collection.on("data_channel_added",function(t){return function(e,n){return t.emit("data_channel_added",e,n)}}(this)),this.peer_connection.on("stream_added",function(t){return function(e){return t.stream_collection.resolve(e)}}(this)),this.peer_connection.on("data_channel_ready",function(t){return function(e){return t.channel_collection.resolve(e)}}(this)),this.peer_connection.on("signaling",function(t){return function(e){return e.streams=t.streams_desc,e.channels=t.channels_desc,t.signaling.send("signaling",e)}}(this)),this.signaling.on("signaling",function(t){return function(e){return t.stream_collection.update(e.streams),t.channel_collection.setRemote(e.channels),t.peer_connection.signaling(e)}}(this)),this.peer_connection.on("ice_candidate",function(t){return function(e){return t.signaling.send("ice_candidate",e)}}(this)),this.signaling.on("ice_candidate",function(t){return function(e){return t.peer_connection.addIceCandidate(e)}}(this)),this.signaling.on("status_changed",function(t){return function(e){return t.emit("status_changed",e)}}(this)),this.signaling.on("message",function(t){return function(e){return t.emit("message",e)}}(this)),this.signaling.on("left",function(t){return function(){return t.peer_connection.close(),t.emit("left")}}(this)),this.peer_connection.on("connected",function(){return function(){}}(this)),this.peer_connection.on("closed",function(){return function(){}}(this)),(null==this.options.auto_connect||this.options.auto_connect)&&this.connect()}return u(n,t),n.prototype.status=function(t){return this.signaling.status[t]},n.prototype.message=function(t){return this.signaling.send("message",t)},n.prototype.connect=function(){var t,e,n,r,o;if(null==this.connect_p){o=[],n=s(this.local.streams,this.private_streams);for(t in n)r=n[t],e=r.then(function(e){return[t,e]}),o.push(e);this.connect_p=i.all(o).then(function(e){return function(n){var i,o,u,c,a;for(i=0,o=n.length;o>i;i++)c=n[i],t=c[0],r=c[1],e.peer_connection.addStream(r),e.streams_desc[t]=r.id();a=s(e.local.channels,e.private_channels);for(t in a)u=a[t],e.peer_connection.addDataChannel(t,u),e.channels_desc[t]=u;return e.channel_collection.setLocal(e.channels_desc),e.peer_connection.connect()}}(this))}return this.connect_p},n.prototype.close=function(){this.peer_connection.close()},n.prototype.stream=function(t){return null==t&&(t=this.DEFAULT_STREAM),this.stream_collection.get(t)},n.prototype.addStream=function(t,e){var n,r;return this.options.auto_connect!==!1?i.reject("Unable to add streams directly to remote peers without 'auto_connect' option set to 'false'"):(n=function(e){return function(n){return e.private_streams[t]=n,n}}(this),"string"!=typeof t&&(e=t,t=this.DEFAULT_STREAM),null!=(null!=e?e.then:void 0)?n(e):e instanceof Stream?n(i.resolve(e)):(r=Stream.createStream(e),n(r)))},n.prototype.channel=function(t){return null==t&&(t=this.DEFAULT_CHANNEL),this.channel_collection.get(t)},n.prototype.addDataChannel=function(t,e){return this.options.auto_connect!==!1?i.reject("Unable to add channels directly to remote peers without 'auto_connect' option set to 'false'"):("string"!=typeof t&&(e=t,t=this.DEFAULT_CHANNEL),null==e&&(e={ordered:!0}),this.private_channels[t]=e,this.channel(t))},n.prototype.isLocal=function(){return!1},n}(r)}).call(this)},{"./internal/channel_collection":7,"./internal/promise":8,"./internal/stream_collection":9,"./peer":12}],15:[function(t,e,n){(function(){var e,r,i,o,s,u,c=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;e=t("events").EventEmitter,u=t("./signaling/web_socket_channel").WebSocketChannel,i=t("./signaling/muc_signaling").MucSignaling,s=t("./remote_peer").RemotePeer,r=t("./local_peer").LocalPeer,o=t("./peer_connection").PeerConnection,n.Room=function(t){function e(t,e){var n;this.signaling=t,this.options=null!=e?e:{},("string"==typeof this.signaling||this.signaling instanceof String)&&(n=new u(this.signaling),this.signaling=new i(n)),this.local=this.options.local||new r,this.signaling.setStatus(this.local._status),this.local.on("status_changed",function(t){return function(){return t.signaling.setStatus(t.local._status)}}(this)),this.signaling.on("peer_joined",function(t){return function(e){var n,r;return n=new o(e.first,t.options),r=t.createPeer(n,e),r.on("status_changed",function(e){return t.emit("peer_status_changed",r,e)}),r.on("left",function(){return delete t.peers[e.id],t.emit("peer_left",r)}),t.peers[e.id]=r,t.emit("peer_joined",r),r.on("closed",function(){return delete t.peers[e.id]})}}(this)),this.peers={}}return c(e,t),e.prototype.connect=function(){return null==this.join_p&&(this.join_p=this.signaling.connect()),this.join_p},e.prototype.leave=function(){return this.signaling.leave()},e.prototype.destroy=function(){return this.signaling.leave()},e.prototype.createPeer=function(t,e){return new s(t,e,this.local,this.options)},e}(e)}).call(this)},{"./local_peer":11,"./peer_connection":13,"./remote_peer":14,"./signaling/muc_signaling":17,"./signaling/web_socket_channel":20,events:1}],16:[function(t,e){(function(){var n,r,i,o,s,u,c,a,l,h,p,f,d,m,_,g,v,y,w,b=function(t,e){function n(){this.constructor=t}for(var r in e)E.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},E={}.hasOwnProperty;m=t("events").EventEmitter,w=t("../internal/promise"),
_=w.Promise,d=w.Deferred,y=t("extend"),v=t("../room").Room,g=t("../remote_peer").RemotePeer,n=function(t){function e(t,e){var n;this.channel=t,this.room_options=e,this.next_tid=0,this.answers={},n=new d,this.hello_p=n.promise,this.channel.on("message",function(t){return function(e){var o,s,u;switch(t.resetPing(),e.type){case"hello":return t.id=e.id,n.resolve(e.server);case"answer":return null==e.tid?void console.log("Missing transaction id in answer"):(o=t.answers[e.tid],delete t.answers[e.tid],null==o?void console.log("Answer without expecting it"):null!=o.resolve?null!=e.error?o.reject(new Error(e.error)):o.resolve(e.data):null!=e.error?o(new Error(e.error)):o(void 0,e.data));case"invite_incoming":return null!=e.handle&&null!=e.sender&&e.room&&null!=e.status&&null!=e.peers&&null!=e.data?(s=new r(t,e.handle),u=new i(s,t.room_options,e.sender,e.data),u.signaling.init(e),t.emit("invitation",u)):void console.log("Invalid message")}}}(this)),this.channel.on("closed",function(t){return function(){return t.emit("closed"),t.ping_interval?(clearInterval(t.ping_interval),delete t.ping_interval):void 0}}(this))}return b(e,t),e.prototype.connect=function(){return this.channel.connect().then(function(t){return function(){return t.resetPing(),t.hello_p}}(this))},e.prototype.request=function(t,e){var n;return t.tid=this.next_tid++,this.channel.send(t),this.resetPing(),null==e?(n=new d,this.answers[t.tid]=n,n.promise):void(this.answers[t.tid]=e)},e.prototype.ping=function(){return this.request({type:"ping"})},e.prototype.resetPing=function(){return this.ping_timeout&&clearTimeout(this.ping_timeout),this.ping_timeout=setTimeout(function(t){return function(){return t.ping(),t.resetPing()}}(this),12e4)},e.prototype.subscribe=function(t){return new _(function(e){return function(n,r){return e.request({type:"ns_subscribe",namespace:t},function(i,s){var u,c,a,l,h,p;if(null!=i)return r(i);c=new o(e,t),a=s.users;for(u in a)p=a[u],c.addUser(u,p);l=s.rooms;for(u in l)h=l[u],c.addRoom(u,h.status,h.peers);return n(c)})}}(this))},e.prototype.register=function(t){return this.request({type:"ns_user_register",namespace:t})},e.prototype.unregister=function(t){return this.request({type:"ns_user_unregister",namespace:t})},e.prototype.room=function(t,e){var n;return n=this.room_signaling(t),new h(n,e||this.room_options)},e.prototype.room_signaling=function(t){return new p(this,function(e){return function(n,r){return e.request({type:"room_join",room:t,status:n},r)}}(this))},e.prototype.setStatus=function(t){return this.request({type:"status",status:t})},e.prototype.close=function(){return this.channel.close()},e}(m),o=function(t){function e(t,e){var n;this.calling=t,this.id=e,this.users={},this.rooms={},n=function(t){return function(e){var n,r,i;if(e.namespace===t.id)switch(e.type){case"ns_user_add":return null==e.user||null==e.status?void console.log("Invalid message"):t.addUser(e.user,e.status);case"ns_user_update":return null==e.user||null==e.status?void console.log("Invalid message"):(i=t.users[e.user],null==i?void console.log("Unknown user in status change"):(i.status=e.status,t.emit("user_changed",i),t.emit("user_status_changed",i,i.status),i.emit("status_changed",i.status)));case"ns_user_rm":return null==e.user?void console.log("Invalid message"):(i=t.users[e.user],null==i?void console.log("Unknown user leaving"):(delete t.users[e.user],t.emit("user_changed",i),t.emit("user_left",i),i.emit("left")));case"ns_room_add":return null==e.room||null==e.status||null==e.peers?void console.log("Invalid message"):t.addRoom(e.room,e.status,e.peers);case"ns_room_update":return null==e.room||null==e.status?void console.log("Invalid message"):(r=t.rooms[e.room],null==r?void console.log("Invalid room"):(r.status=e.status,t.emit("room_changed",r),t.emit("room_status_changed",r,r.status),r.emit("status_changed",r.status)));case"ns_room_rm":return null==e.room?void console.log("Invalid message"):(r=t.rooms[e.room],null==r?void console.log("Invalid room"):(delete t.rooms[e.room],t.emit("room_changed",r),t.emit("room_closed"),r.emit("closed")));case"ns_room_peer_add":return null==e.room||null==e.user||null==e.status||null==e.pending?void console.log("Invalid message"):(r=t.rooms[e.room],null==r?void console.log("Invalid room"):(n=r.addPeer(e.user,e.status,e.pending),t.emit("room_changed",r),t.emit("room_peer_joined",r,n)));case"ns_room_peer_update":if(null==e.room||null==e.user)return void console.log("Invalid message");if(r=t.rooms[e.room],n=null!=r?r.peers[e.user]:void 0,null==n)return void console.log("Invalid peer");if(null!=e.status&&(n.status=e.status,t.emit("room_changed",r),t.emit("room_peer_status_changed",r,n,n.status),n.emit("status_changed",n.status)),null!=e.pending&&e.pending===!1)return n.pending=!1,n.accepted_d.resolve(),t.emit("room_changed",r),t.emit("peer_accepted",n),n.emit("accepted");break;case"ns_room_peer_rm":return null==e.room||null==e.user?void console.log("Invalid message"):(r=t.rooms[e.room],n=null!=r?r.peers[e.user]:void 0,null==n?void console.log("Invalid peer"):(delete t.rooms[e.room].peers[e.user],t.emit("room_changed",r),t.emit("room_peer_left",r,n),n.emit("left")))}}}(this),this.calling.channel.on("message",n),this.on("unsubscribed",function(t){return function(){return t.calling.channel.removeListener("message",n)}}(this))}return b(e,t),e.prototype.addUser=function(t,e){var n;return n=new c(t,e),this.users[t]=n,this.emit("user_changed",n),this.emit("user_registered",n),n},e.prototype.addRoom=function(t,e,n){var r,i,o;o=new s(t,e);for(i in n)r=n[i],o.addPeer(i,r.status,r.pending);return this.rooms[t]=o,this.emit("room_changed",o),this.emit("room_registered",o),o},e.prototype.unsubscribe=function(){return new _(function(t){return function(e,n){return t.calling.request({type:"ns_unsubscribe",namespace:t.id},function(r){var i,o,s;if(null!=r)return n(r);o=t.users;for(i in o)s=o[i],s.emit("left");return t.users={},t.emit("unsubscribed"),e()})}}(this))},e}(m),c=function(t){function e(t,e,n){this.id=t,this.status=e,this.pending=n}return b(e,t),e}(m),s=function(t){function e(t,e){this.id=t,this.status=e,this.peers={}}return b(e,t),e.prototype.addPeer=function(t,e,n){var r;return r=new u(t,e,n),this.peers[t]=r,this.emit("peer_joined",r),r},e}(m),u=function(t){function e(t,e,n){this.id=t,this.status=e,this.pending=n,this.accepted_d=new d,this.pending||this.accepted_d.resolve(),this.on("left",function(t){return function(){return t.accepted_d.reject("Peer left")}}(this))}return b(e,t),e.prototype.accepted=function(){return this.accepted_d.promise},e}(m),p=function(t){function e(t,e){var n;this.calling=t,this.connect_fun=e,this.peer_status={},this.peers={},this.initialized=!1,n=function(t){return function(e){var n;if(e.room===t.id)switch(e.type){case"room_update":return null==e.status?void console.log("Invalid message"):(t.status=e.status,t.emit("status_changed",t.status));case"room_peer_add":return null==e.user||null==e.pending||null==e.status?void console.log("Invalid message"):t.addPeer(e.user,e.status,e.pending,!0);case"room_peer_rm":return console.log("removing"),null==e.user?void console.log("Invalid message"):(n=t.peers[e.user],null==n?void console.log("Unknown peer accepted"):(delete t.peers[e.user],n.accepted_d.reject("User left"),console.log("removed",t.peers),t.emit("peer_left",n),n.emit("left")));case"room_peer_update":if(null==e.user)return void console.log("Invalid message");if(n=t.peers[e.user],null==n)return void console.log("Unknown peer accepted");if(null!=e.status&&(n.status=e.status,t.emit("peer_status_changed",n,n.status),n.emit("status_changed",n.status)),null!=e.pending&&e.pending===!1)return n.pending=!1,n.accepted_d.resolve(),t.emit("peer_accepted"),n.emit("accepted");break;case"room_peer_from":return null==e.user||null==e.event?void console.log("Invalid message",e):(n=t.peers[e.user],null==n?void console.log("Unknown peer accepted"):(t.emit("peer_left"),n.emit(e.event,e.data)))}}}(this),this.calling.channel.on("message",n),this.on("left",function(t){return function(){return t.calling.channel.removeListener("message",n)}}(this))}return b(e,t),e.prototype.init=function(t){var e,n,r;if(this.initialized)throw new Error("Room is already initialized");if(null==t.room||null==t.peers||null==t.status)throw console.log(t),new Error("Invalid initialization data");this.id=t.room,this.status=t.status,n=t.peers;for(r in n)e=n[r],this.addPeer(r,e.status,e.pending,!1);return this.initialized=!0},e.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=new _(function(t){return function(e,n){return t.connect_fun(t.peer_status,function(r,i){return null!=r?n(r):(null!=i&&t.init(i),t.initialized?e():void n(new Error("Missing information from connect response")))})}}(this))),this.connect_p},e.prototype.addPeer=function(t,e,n,r){var i;return i=new f(this,t,e,n,r),this.peers[t]=i,this.emit("peer_joined",i),i},e.prototype.leave=function(){return new _(function(t){return function(e){return t.calling.request({type:"room_leave",room:t.id},function(){var n,r,i;t.emit("left"),i=t.peers;for(n in i)r=i[n],r.emit("left"),r.accepted_d.reject("You left the room");return e()})}}(this))},e.prototype.setStatus=function(t){return this.peer_status=t,null!=this.connect_p?this.calling.request({type:"room_peer_status",room:this.id,status:t}):_.resolve()},e.prototype.invite=function(t,e){return null==e&&(e={}),new _(function(n){return function(r,i){return n.calling.request({type:"invite_send",room:n.id,user:t.id,data:e},function(e,o){var s;return null!=e?i(e):null==o.handle?void i(new Error("Invalid response")):(s=new a(n.calling,o.handle,t),r(s))})}}(this))},e.prototype.setRoomStatusSafe=function(t,e,n){return new _(function(r){return function(i,o){return r.calling.request({type:"room_status",room:r.id,key:t,value:e,check:!0,previous:n},function(n){return n?void o(n):(r.status[t]=e,r.emit("status_changed",r.status),i())})}}(this))},e.prototype.setRoomStatus=function(t,e){return new _(function(n){return function(r,i){return n.calling.request({type:"room_status",room:n.id,key:t,value:e},function(o){return o?void i(o):(n.status[t]=e,n.emit("status_changed",n.status),r())})}}(this))},e.prototype.register=function(t){return this.calling.request({type:"ns_room_register",namespace:t,room:this.id})},e.prototype.unregister=function(t){return this.calling.request({type:"ns_room_unregister",namespace:t,room:this.id})},e}(m),f=function(t){function e(t,e,n,r,i){this.room=t,this.id=e,this.status=n,this.pending=r,this.first=i,this.accepted_d=new d,this.pending||this.accepted_d.resolve()}return b(e,t),e.prototype.accepted=function(){return this.accepted_d.promise},e.prototype.send=function(t,e){return this.room.calling.request({type:"room_peer_to",room:this.room.id,user:this.id,event:t,data:e})},e}(m),r=function(t){function e(t,e,n,r){var i;this.calling=t,this.handle=e,this.sender=n,this.data=r,this.cancelled=!1,i=function(t){return function(e){if(e.handle===t.handle)switch(e.type){case"invite_cancelled":return t.cancelled=!0,t.emit("cancelled"),t.emit("handled",!1)}}}(this),this.calling.channel.on("message",i),this.on("handled",function(t){return function(){return t.calling.channel.removeListener("message",i)}}(this))}return b(e,t),e.prototype.signaling=function(){return new p(this.calling,function(t){return function(e,n){return t.emit("handled",!0),t.calling.request({type:"invite_accept",handle:t.handle,status:e},n)}}(this))},e.prototype.deny=function(){return this.emit("handled",!1),this.calling.request({type:"invite_deny",handle:this.handle})},e}(m),a=function(){function t(t,e,n){var r,i;this.calling=t,this.handle=e,this.user=n,this.defer=new d,this.pending=!0,i=function(t){return function(e){if(e.handle===t.handle)switch(e.type){case"invite_response":return null==e.accepted?void console.log("Invalid message"):(t.pending=!1,t.defer.resolve(e.accepted))}}}(this),this.calling.channel.on("message",i),r=function(t){return function(){return t.calling.channel.removeListener("message",i)}}(this),this.defer.promise.then(r,r)}return t.prototype.response=function(){return this.defer.promise},t.prototype.cancel=function(){return this.pending=!1,this.calling.request({type:"invite_cancel",handle:this.handle}).then(function(t){return function(){t.defer.reject(new Error("Invitation cancelled"))}}(this))},t}(),h=function(t){function e(t,n){n=y({auto_connect:!1},n),e.__super__.constructor.call(this,t,n)}return b(e,t),e.prototype.createPeer=function(t,e){return new l(t,e,this.local,this.options)},e.prototype.invite=function(t){return this.signaling.invite(t)},e.prototype.register=function(t){return this.signaling.register(t)},e.prototype.unregister=function(t){return this.signaling.unregister(t)},e}(v),i=function(t){function e(t,n,r,i){this.invitation=t,this.sender_id=r,this.data=i,e.__super__.constructor.call(this,this.invitation.signaling(),n),this.invitation.on("cancelled",function(t){return function(){return t.emit("cancelled")}}(this)),this.invitation.on("handled",function(t){return function(e){return t.emit("handled",e)}}(this))}return b(e,t),e.prototype.sender=function(){return this.peers[this.sender_id]},e.prototype.deny=function(){return this.invitation.deny()},e}(h),l=function(t){function e(t,n,r,i){e.__super__.constructor.call(this,t,n,r,i)}return b(e,t),e.prototype.connect=function(){return console.log("connecting .."),this.signaling.accepted().then(function(t){return function(){return console.log("accepted .."),e.__super__.connect.call(t)}}(this))},e}(g),e.exports={Calling:n,CallingNamespace:o,CallingNamespaceUser:c,CallingNamespaceRoom:s,CallingNamespaceRoomPeer:u,CallingSignaling:p,CallingSignalingPeer:f,CallingInInvitation:r,CallingOutInvitation:a}}).call(this)},{"../internal/promise":8,"../remote_peer":14,"../room":15,events:1,extend:4}],17:[function(t,e,n){(function(){var e,r,i,o,s,u=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;e=t("../internal/promise").Deferred,s=t("./signaling"),i=s.Signaling,o=s.SignalingPeer,r=t("events").EventEmitter,n.MucSignalingPeer=function(t){function e(t,e,n,r){var i;this.channel=t,this.id=e,this.status=n,this.first=r,i=function(t){return function(e){if(e.peer===t.id&&null!=e.type)switch(e.type){case"from":if(null==e.event||null==e.data)return;return t.emit(e.event,e.data);case"peer_left":return t.emit("left"),t.channel.removeListener("message",i);case"peer_status":return t.status=e.status,t.emit("status_changed",t.status)}}}(this),this.channel.on("message",i)}return u(e,t),e.prototype.send=function(t,e){return null==e&&(e={}),this.channel.send({type:"to",peer:this.id,event:t,data:e})},e}(o),n.MucSignaling=function(t){function r(t){var r;this.channel=t,this.status={},r=new e,this.join_p=r.promise,this.channel.on("closed",function(t){return function(){return t.emit("closed")}}(this)),this.channel.on("message",function(t){return function(e){var i,o,s,u;if(null!=e.type)switch(e.type){case"joined":if(null==e.peers)return;s=e.peers;for(o in s)u=s[o],i=new n.MucSignalingPeer(t.channel,o,u,!1),t.emit("peer_joined",i);return t.id=e.id,r.resolve();case"peer_joined":if(null==e.peer)return;return i=new n.MucSignalingPeer(t.channel,e.peer,e.status,!0),t.emit("peer_joined",i)}}}(this))}return u(r,t),r.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=this.channel.connect().then(function(t){return function(){return t.channel.send({type:"join",status:t.status})}}(this)).then(function(t){return function(){return t.join_d}}(this))),this.connect_p},r.prototype.setStatus=function(t){return this.status=t,this.connect_p?this.connect_p.then(function(e){return function(){return e.channel.send({type:"status",status:t})}}(this)):void 0},r.prototype.leave=function(){return this.channel.send({type:"leave"}).then(function(){return this.channel.close()})},r}(i)}).call(this)},{"../internal/promise":8,"./signaling":19,events:1}],18:[function(t,e,n){(function(){var e,r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;e=t("../internal/promise").Deferred,o=t("./signaling"),r=o.Signaling,i=o.SignalingPeer,n.PalavaSignalingPeer=function(t){function e(t,e,n,r){var i;this.channel=t,this.id=e,this.status=n,this.first=r,i=function(t){return function(e){return e.sender_id===t.id?null==e.event?void t.send("error","Invalid message"):t.emit(e.event,e.data):void 0}}(this),this.channel.on("message",i),this.on("peer_updated_status",function(t){return function(e){return t.emit("status_changed",e)}}(this)),this.on("peer_left",function(t){return function(){return t.emit("closed"),t.channel.removeListener("message",i)}}(this))}return s(e,t),e.prototype.send=function(t,e){return null==e&&(e={}),this.channel.send({event:"send_to_peer",peer_id:this.id,data:{event:t,data:e}})},e}(i),n.PalavaSignaling=function(t){function r(t,r,i){var o;this.channel=t,this.room=r,this.status=i,this.peers={},this.joined=!1,o=new e,this.join_p=o.promise,this.channel.on("closed",function(t){return function(){return t.emit("closed")}}(this)),this.channel.on("message",function(t){return function(e){var r,i,s;if(null!=e.event)switch(e.event){case"joined_room":if(null==e.peers||null==e.own_id)return;s=e.peers;for(r in s)e=s[r],i=new n.PalavaSignalingPeer(t.channel,e.peer_id,e.status,!1),t.peers[e.peer_id]=i,t.emit("peer_joined",i);return o.resolve();case"new_peer":if(null==e.peer_id)return;return i=new n.PalavaSignalingPeer(t.channel,e.peer_id,e.status,!0),t.peers[e.peer]=i,t.emit("peer_joined",i)}}}(this))}return s(r,t),r.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=this.channel.connect().then(function(t){return function(){return t.channel.send({event:"join_room",room_id:room,status:status})}}(this))),this.connect_p},r.prototype.set_status=function(t){return this.channel.send({event:"update_status",status:t})},r.prototype.leave=function(){return this.channel.close()},r}(r)}).call(this)},{"../internal/promise":8,"./signaling":19}],19:[function(t,e,n){(function(){var e,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=t("events").EventEmitter,n.Signaling=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.connect=function(){throw new Error("Not implemented")},e.prototype.close=function(){throw new Error("Not implemented")},e.prototype.setStatus=function(){throw new Error("Not implemented")},e}(e),n.SignalingPeer=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.send=function(t,e){throw null==e&&(e={}),new Error("Not implemented")},e}(e),n.Channel=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.connect=function(){throw new Error("Not implemented")},e.prototype.send=function(){throw new Error("Not implemented")},e.prototype.close=function(){throw new Error("Not implemented")},e}(e)}).call(this)},{events:1}],20:[function(t,e,n){(function(){var e,r,i=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty,s=[].slice;r=t("../internal/promise").Promise,e=t("./signaling").Channel,n.WebSocketChannel=function(t){function e(){var t,e,n,r,i;if(t=arguments[0],i=2<=arguments.length?s.call(arguments,1):[],this.address=t,i.length>0){for(;this.address.endsWith("/");)this.address=this.address.substr(0,this.address.length-1);for(e=0,n=i.length;n>e;e++)r=i[e],this.address+="/"+encodeUriComponent(r)}}return i(e,t),e.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=new r(function(t){return function(e,n){var r;return r=new WebSocket(t.address),r.onopen=function(){return t.socket=r,e()},r.onerror=function(e){return delete t.socket,t.emit("error",e),n(new Error("Unable to connect to socket"))},r.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(r){return void t.emit("error","Unable to parse incoming message")}return t.emit("message",n)},r.onclose=function(){return t.emit("closed")}}}(this))),this.connect_p},e.prototype.send=function(t){var e;if(null==this.socket)return r.reject(new Error("Trying to send on WebSocket without being connected"));try{return this.socket.send(JSON.stringify(t)),r.resolve()}catch(n){return e=n,r.reject(e)}},e.prototype.close=function(){var t;if(null==this.socket)return r.reject(new Error("Trying to close WebSocket without being connected"));try{return this.socket.close(),r.resolve()}catch(e){return t=e,r.reject(t)}},e}(e)}).call(this)},{"../internal/promise":8,"./signaling":19}],21:[function(t,e,n){(function(){var e;e=t("./compat").compat,n.Stream=function(){function t(t){this.stream=t}return t.prototype.id=function(){return this.stream.id},t.prototype.hasTracks=function(t){return this.getTracks(t).length},t.prototype.getTracks=function(t){if(t=t.toLowerCase(),"audio"===t)return this.stream_p.then(function(t){return t.getAudioTracks()});if("video"===t)return this.stream_p.then(function(t){return t.getVideoTracks()});if("both"===t)return this.stream_p.then(function(t){var e,n;return n=t.getVideoTracks(),e=t.getAudioTracks(),n.concat(audio)});throw new Error("Invalid stream part '"+t+"'")},t.prototype.mute=function(t,e){var n,r,i,o;for(null==t&&(t=!0),null==e&&(e="audio"),i=getTracks(e),n=0,r=i.length;r>n;n++)o=i[n],o.enabled=!t;return t},t.prototype.toggleMute=function(t){var e,n,r,i,o,s;for(null==t&&(t="audio"),s=getTracks(t),r=!(null!=(i=s[0])?i.enabled:void 0),e=0,n=s.length;n>e;e++)o=s[e],o.enabled=!r;return r},t.prototype.stop=function(){var t,e,n,r,i;if(null!=this.stream.getTracks){for(n=this.stream.getTracks(),r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(i.stop());return r}return this.stream.stop()},t.createStream=function(n){return null==n&&(n={audio:!0,video:!0}),new Promise(function(r,i){var o;return o=function(e){return r(new t(e))},e.getUserMedia(n,o,i)})},t}()}).call(this)},{"./compat":5}],22:[function(t,e,n){(function(){var e,r;r=t("./stream").Stream,e=t("./peer").Peer,n.MediaDomElement=function(){function t(t,e){this.dom=t,null!=this.dom.jquery&&(this.dom=this.dom[0]),this.attach(e)}return t.prototype.attach=function(t){return null==t?(delete this.stream,this.dom.pause(),this.dom.src=null):t instanceof r?(this.stream=t,"undefined"!=typeof mozGetUserMedia&&null!==mozGetUserMedia?this.dom.mozSrcObject=t.stream:this.dom.src=URL.createObjectURL(t.stream),this.dom.play()):t instanceof e?(t.isLocal()&&this.mute(),this.attach(t.stream())):null!=(null!=t?t.then:void 0)?t.then(function(t){return function(e){return t.attach(e)}}(this))["catch"](function(t){return function(e){return t.error(e)}}(this)):this.error("Tried to attach invalid data")},t.prototype.error=function(t){return console.log(t)},t.prototype.clear=function(){return this.attach()},t.prototype.mute=function(t){return null==t&&(t=!0),this.dom.muted=t},t.prototype.toggleMute=function(){return this.dom.muted=!this.dom.muted},t}()}).call(this)},{"./peer":12,"./stream":21}]},{},[10])(10)});