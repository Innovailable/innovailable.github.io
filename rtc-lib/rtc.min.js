!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.rtc=t()}}(function(){return function t(n,e,r){function o(s,c){if(!e[s]){if(!n[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=e[s]={exports:{}};n[s][0].call(l.exports,function(t){var e=n[s][1][t];return o(e?e:t)},l,l.exports,t,n,e,r)}return e[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,n,e){(function(){var t,n;t=function(t,n){return null!=n?n.bind(t):void 0},e.compat=n={PeerConnection:window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,IceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate,SessionDescription:window.mozRTCSessionDescription||window.RTCSessionDescription,MediaStream:window.MediaStream||window.mozMediaStream||window.webkitMediaStream,getUserMedia:t(navigator,navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),supported:function(){return null!=n.PeerConnection&&null!=n.IceCandidate&&null!=n.SessionDescription&&null!=n.getUserMedia}}}).call(this)},{}],2:[function(t,n,e){(function(){var n,r,o,i,s=function(t,n){function e(){this.constructor=t}for(var r in n)c.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},c={}.hasOwnProperty;i=t("./internal/promise"),n=i.Deferred,o=i.Promise,r=t("events").EventEmitter,e.DataChannel=function(t){function e(t,n){this.channel=t,this.max_buffer=null!=n?n:10240,this._connected=!1,this._connect_queue=[],this._send_buffer=[],this.channel.onmessage=function(t){return function(n){return t._connected?t.emit("message",n.data):t._connect_queue.push(n.data)}}(this),this.channel.onclose=function(t){return function(){return t.emit("closed")}}(this),this.channel.onerror=function(t){return function(n){return t.emit("error",n)}}(this)}return s(e,t),e.prototype.connect=function(){var t,n,e,r;for(this._connected=!0,r=this._connect_queue,n=0,e=r.length;e>n;n++)t=r[n],this.emit("message",t);return delete this._connect_queue,o.resolve()},e.prototype.label=function(){return this.channel.label},e.prototype.send=function(t){var e;return this._connected||(this.connect(),console.log("Sending without being connected. Please call connect() on the data channel to start using it.")),e=new n,this._send_buffer.push([t,e]),1===this._send_buffer.length&&this._actualSend(),e.promise},e.prototype._actualSend=function(){var t,n,e,r,o;if("open"!==this.channel.readyState){for(o=[];this._send_buffer.length;)r=this._send_buffer.shift(),t=r[0],n=r[1],o.push(n.reject(new Error("DataChannel closed")));return o}for(;this._send_buffer.length;){if(this.channel.bufferedAmount>=this.max_buffer)return void setTimeout(this._actualSend.bind(this),1);e=this._send_buffer[0],t=e[0],n=e[1];try{this.channel.send(t)}catch(i){return void setTimeout(this._actualSend.bind(this),1)}n.resolve(),this._send_buffer.shift()}},e}(r)}).call(this)},{"./internal/promise":4,events:void 0}],3:[function(t,n,e){(function(){var n,r,o,i,s=function(t,n){function e(){this.constructor=t}for(var r in n)c.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},c={}.hasOwnProperty;i=t("./promise"),n=i.Deferred,o=i.Promise,r=t("events").EventEmitter,e.ChannelCollection=function(t){function e(){this.channels={},this.defers={},this.pending={},this.wait_d=new n,this.wait_p=this.wait_d.promise}return s(e,t),e.prototype.setLocal=function(t){return this.local=t,null!=this.remote?this._update():void 0},e.prototype.setRemote=function(t){return this.remote=t,null!=this.local?this._update():void 0},e.prototype._update=function(){var t,e,r,i,s;s=this.remote;for(i in s)e=s[i],null!=this.local[i]?null!=this.channels[i]||(null!=this.pending[i]?(t=this.pending[i],delete this.pending[i],this.channels[i]=o.resolve(t),this.emit("data_channel_added",i,this.channels[i])):(r=new n,this.channels[i]=r.promise,this.defers[i]=r,this.emit("data_channel_added",i,this.channels[i]))):console.log("DataChannel offered by remote but not by local");for(i in this.local)null==this.remote[i]&&console.log("DataChannel offered by local but not by remote");return this.wait_d.resolve()},e.prototype.resolve=function(t){var n;return n=t.label(),null!=this.defers[n]?(this.defers[n].resolve(t),delete this.defers[n]):this.pending[n]=t},e.prototype.get=function(t){return this.wait_p.then(function(n){return function(){if(null!=n.channels[t])return n.channels[t];throw new Error("DataChannel not negotiated")}}(this))},e}(r)}).call(this)},{"./promise":4,events:void 0}],4:[function(t,n,e){(function(n){(function(){e.Promise=n.Promise||t("es6-promise").Promise,e.Deferred=function(){function t(){this.promise=new e.Promise(function(t){return function(n,e){return t.resolve=n,t.reject=e}}(this))}return t}()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es6-promise":void 0}],5:[function(t,n,e){(function(){var n,r,o=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;n=t("./promise").Deferred,r=t("events").EventEmitter,e.StreamCollection=function(t){function e(){this.streams={},this._defers={},this._waiting={},this._pending={},this.wait_d=new n,this.wait_p=this.wait_d.promise}return o(e,t),e.prototype.update=function(t){var e,r,o,i,s,c,a,u,l;for(s=[],this._waiting={},a=this.streams,l=r=0,i=a.length;i>r;l=++r)c=a[l],null==t[c]&&(delete this.streams[c],this.emit("stream_removed",c),l.isFullfilled()?l.then(function(t){return t.close()}):l.isPending()&&l.reject(new Error("Stream removed before being established")));for(c in t)o=t[c],null==this.streams[c]&&(e=new n,this.streams[c]=e.promise,this._defers[c]=e,this.emit("stream_added",c,e.promise)),null!=this._defers[c]&&(null!=this._pending[o]?(u=this._pending[o],delete this._pending[o],this._defers[c].resolve(u),delete this._defers[c]):this._waiting[o]=c);return this.wait_d.resolve()},e.prototype.resolve=function(t){var n,e;return n=t.id(),null!=this._waiting[n]?(e=this._waiting[n],delete this._waiting[n],this._defers[e].resolve(t),delete this._defers[e]):this._pending[n]=t},e.prototype.get=function(t){return this.wait_p.then(function(n){return function(){if(null!=n.streams[t])return n.streams[t];throw new Error("Stream not offered")}}(this))},e}(r)}).call(this)},{"./promise":4,events:void 0}],6:[function(t,n){(function(){var e,r;r=function(t,n){var r,o;for(r in n)o=n[r],t[r]=o;return e},n.exports=e={internal:{},signaling:{}},r(e,t("./peer")),r(e,t("./remote_peer")),r(e,t("./local_peer")),r(e,t("./peer_connection")),r(e,t("./stream")),r(e,t("./compat")),r(e,t("./room")),r(e,t("./video_element")),r(e.internal,t("./internal/stream_collection")),r(e.internal,t("./internal/channel_collection")),r(e.internal,t("./internal/promise")),r(e.signaling,t("./signaling/web_socket_channel")),r(e.signaling,t("./signaling/palava_signaling"))}).call(this)},{"./compat":1,"./internal/channel_collection":3,"./internal/promise":4,"./internal/stream_collection":5,"./local_peer":7,"./peer":8,"./peer_connection":9,"./remote_peer":10,"./room":11,"./signaling/palava_signaling":13,"./signaling/web_socket_channel":14,"./stream":15,"./video_element":16}],7:[function(t,n,e){(function(){var n,r,o=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;n=t("./peer").Peer,r=t("./stream").Stream,e.LocalPeer=function(t){function n(){this.streams={},this.channels={},this._status={}}return o(n,t),n.prototype.status=function(t,n){return null==n?this._status[t]:(this._status[t]=n,void this.emit("status_changed",this._status))},n.prototype.addDataChannel=function(t,n){"string"!=typeof t&&(n=t,t=this.DEFAULT_CHANNEL),null==n&&(n={ordered:!0}),this.channels[t]=n,this.emit("configuration_changed")},n.prototype.addStream=function(t,n){var e,o;return e=function(n){return function(e){return n.streams[t]=e,n.emit("configuration_changed"),e}}(this),"string"!=typeof t&&(n=t,t=this.DEFAULT_STREAM),null!=(null!=n?n.then:void 0)?e(n):n instanceof r?e(Promise.resolve(n)):(o=r.createStream(n),e(o))},n.prototype.stream=function(t){return null==t&&(t=this.DEFAULT_STREAM),this.streams[t]},n}(n)}).call(this)},{"./peer":8,"./stream":15}],8:[function(t,n,e){(function(){var n,r=function(t,n){function e(){this.constructor=t}for(var r in n)o.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},o={}.hasOwnProperty;n=t("events").EventEmitter,e.Peer=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.DEFAULT_CHANNEL="data",n.prototype.DEFAULT_STREAM="stream",n.prototype.status=function(){throw new Error("Not implemented")},n}(n)}).call(this)},{events:void 0}],9:[function(t,n,e){(function(){var n,r,o,i,s,c,a,u=function(t,n){function e(){this.constructor=t}for(var r in n)l.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},l={}.hasOwnProperty;a=t("./internal/promise"),r=a.Deferred,i=a.Promise,o=t("events").EventEmitter,s=t("./stream").Stream,n=t("./data_channel").DataChannel,c=t("./compat").compat,e.PeerConnection=function(t){function e(t,e){this.offering=t,this.options=e,this.pc=new c.PeerConnection(this._iceOptions()),this.connect_d=new r,this.connected=!1,this.signaling_pending=[],this.pc.onicecandidate=function(t){return function(n){return t.emit("ice_candidate",n.candidate)}}(this),this.pc.onaddstream=function(t){return function(n){return t.emit("stream_added",new s(n.stream))}}(this),this.pc.ondatachannel=function(t){return function(e){return t.emit("data_channel_ready",new n(e.channel))}}(this),this.pc.onremovestream=function(){},this.pc.onnegotiationneeded=function(){return function(){return console.log("onnegotiationneeded called")}}(this),this.pc.oniceconnectionstatechange=function(t){return function(){var n;return"failed"===t.pc.iceConnectionState?t._connectError(new Error("Unable to establish ICE connection")):"closed"===t.pc.iceConnectionState?t.connect_d.reject(new Error("Connection was closed")):"connected"===(n=t.pc.iceConnectionState)||"completed"===n?t.connect_d.resolve():void 0}}(this),this.pc.onsignalingstatechange=function(){}}return u(e,t),e.prototype.signaling=function(t){var n;return n=new c.SessionDescription(t),this._setRemoteDescription(n).then(function(n){return function(){return"offer"===t.type&&n.connected?n._answer():void 0}}(this))["catch"](function(t){return function(n){return t._connectError(n)}}(this))},e.prototype.addIceCandidate=function(t){var n;return null!=t.candidate?(n=new c.IceCandidate(t),this.pc.addIceCandidate(n)):console.log("ICE trickling stopped")},e.prototype._iceOptions=function(){var t;return t=[],null!=this.options.stun&&t.push({url:this.options.stun}),{iceServers:t}},e.prototype._oaOptions=function(){return{optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},e.prototype._setRemoteDescription=function(t){return new i(function(n){return function(e,r){var o;return o=new rtc.compat.SessionDescription(t),n.pc.setRemoteDescription(t,e,r)}}(this))},e.prototype._offer=function(){return new i(function(t){return function(n,e){return t.pc.createOffer(n,e,t._oaOptions())}}(this)).then(function(t){return function(n){return t._processLocalSdp(n)}}(this))["catch"](function(t){return function(n){return t._connectError(n)}}(this))},e.prototype._answer=function(){return new i(function(t){return function(n,e){return t.pc.createAnswer(n,e,t._oaOptions())}}(this)).then(function(t){return function(n){return t._processLocalSdp(n)}}(this))["catch"](function(t){return function(n){return t._connectError(n)}}(this))},e.prototype._processLocalSdp=function(t){return new i(function(n){return function(e,r){var o;return o=function(){var r;return r={sdp:t.sdp,type:t.type},n.emit("signaling",r),e(t)},n.pc.setLocalDescription(t,o,r)}}(this))},e.prototype._connectError=function(t){return this.connect_d.reject(t),console.log(t),this.emit("error",t)},e.prototype.addStream=function(t){return this.pc.addStream(t.stream)},e.prototype.removeSream=function(t){return this.pc.removeStream(t.stream)},e.prototype.addDataChannel=function(t,e){var r;return this.offering?(r=this.pc.createDataChannel(t,e),r.onopen=function(t){return function(){return t.emit("data_channel_ready",new n(r))}}(this)):void 0},e.prototype.connect=function(){return this.connected||(this.offering?this._offer():"have-remote-offer"===this.pc.signalingState&&this._answer(),this.connected=!0),this.connect_d.promise},e.prototype.close=function(){return this.pc.close(),this.emit("closed")},e}(o)}).call(this)},{"./compat":1,"./data_channel":2,"./internal/promise":4,"./stream":15,events:void 0}],10:[function(t,n,e){(function(){var n,r,o,i,s=function(t,n){function e(){this.constructor=t}for(var r in n)c.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},c={}.hasOwnProperty;o=t("./internal/promise").Promise,r=t("./peer").Peer,i=t("./internal/stream_collection").StreamCollection,n=t("./internal/channel_collection").ChannelCollection,e.RemotePeer=function(t){function e(t,e,r,o){this.peer_connection=t,this.signaling=e,this.local=r,this.options=o,this.stream_collection=new i,this.streams=this.stream_collection.streams,this.streams_desc={},this.stream_collection.on("stream_added",function(t){return function(n,e){return t.emit("stream_added",n,e)}}(this)),this.channel_collection=new n,this.channels=this.channel_collection.channels,this.channels_desc={},this.channel_collection.on("data_channel_added",function(t){return function(n,e){return t.emit("data_channel_added",n,e)}}(this)),this.peer_connection.on("stream_added",function(t){return function(n){return t.stream_collection.resolve(n)}}(this)),this.peer_connection.on("data_channel_ready",function(t){return function(n){return t.channel_collection.resolve(n)}}(this)),this.peer_connection.on("signaling",function(t){return function(n){return n.streams=t.streams_desc,n.channels=t.channels_desc,t.signaling.send("signaling",n)}}(this)),this.signaling.on("signaling",function(t){return function(n){return t.stream_collection.update(n.streams),t.channel_collection.setRemote(n.channels),t.peer_connection.signaling(n)}}(this)),this.peer_connection.on("ice_candidate",function(t){return function(n){return t.signaling.send("ice_candidate",n)}}(this)),this.signaling.on("ice_candidate",function(t){return function(n){return t.peer_connection.addIceCandidate(n)}}(this)),this.signaling.on("status_changed",function(t){return function(n,e){return t.emit("status_changed",n,e)}}(this)),this.signaling.on("message",function(t){return function(n){return t.emit("message",n)}}(this)),this.signaling.on("left",function(t){return function(){return t.peer_connection.close(),t.emit("left")}}(this)),this.peer_connection.on("connected",function(){return function(){}}(this)),this.peer_connection.on("closed",function(){return function(){}}(this)),null!=this.options.auto_connect&&this.options.auto_connect||this.connect()}return s(e,t),e.prototype.status=function(t){return this.signaling.status[t]},e.prototype.message=function(t){return this.signaling.send("message",t)},e.prototype.connect=function(){var t,n,e,r,i;if(null==this.connect_p){i=[],e=this.local.streams;for(t in e)r=e[t],n=r.then(function(n){return[t,n]}),i.push(n);this.connect_p=o.all(i).then(function(n){return function(e){var o,i,s,c,a;for(o=0,i=e.length;i>o;o++)c=e[o],t=c[0],r=c[1],n.peer_connection.addStream(r),n.streams_desc[t]=r.id();a=n.local.channels;for(t in a)s=a[t],n.peer_connection.addDataChannel(t,s),n.channels_desc[t]=s;return n.channel_collection.setLocal(n.channels_desc),n.peer_connection.connect()}}(this))}return this.connect_p},e.prototype.close=function(){this.peer_connection.close()},e.prototype.stream=function(t){return null==t&&(t=this.DEFAULT_STREAM),this.stream_collection.get(t)},e.prototype.channel=function(t){return null==t&&(t=this.DEFAULT_CHANNEL),this.channel_collection.get(t)},e}(r)}).call(this)},{"./internal/channel_collection":3,"./internal/promise":4,"./internal/stream_collection":5,"./peer":8}],11:[function(t,n,e){(function(){var n,r,o,i,s,c,a=function(t,n){function e(){this.constructor=t}for(var r in n)u.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},u={}.hasOwnProperty;n=t("events").EventEmitter,c=t("./signaling/web_socket_channel.coffee").WebSocketChannel,o=t("./signaling/muc_signaling.coffee").MucSignaling,s=t("./remote_peer.coffee").RemotePeer,r=t("./local_peer.coffee").LocalPeer,i=t("./peer_connection.coffee").PeerConnection,e.Room=function(t){function n(t,n){var e;this.signaling=t,this.options=null!=n?n:{},("string"==typeof this.signaling||this.signaling instanceof String)&&(e=new c(this.signaling),this.signaling=new o(e)),this.local=this.options.local||new r,this.signaling.on("peer_joined",function(t){return function(n){var e,r;return e=new i(n.first,t.options),r=new s(e,n,t.local,t.options),t.peers[n.id]=r,t.emit("peer_joined",r),r.on("closed",function(){return delete t.peers[n.id]})}}(this)),this.peers={}}return a(n,t),n.prototype.connect=function(){return null==this.join_p&&(this.join_p=this.signaling.connect()),this.join_p},n.prototype.leave=function(){return this.signaling.leave()},n.prototype.destroy=function(){return this.signaling.leave()},n}(n)}).call(this)},{"./local_peer.coffee":7,"./peer_connection.coffee":9,"./remote_peer.coffee":10,"./signaling/muc_signaling.coffee":12,"./signaling/web_socket_channel.coffee":14,events:void 0}],12:[function(t,n,e){(function(){var n,r,o=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;n=t("../internal/promise").Deferred,r=t("events").EventEmitter,e.MucSignalingPeer=function(t){function n(t,n,e,r){var o;this.channel=t,this.peer_id=n,this.status=e,this.first=r,o=function(t){return function(n){if(n.peer===t.peer_id&&null!=n.type)switch(n.type){case"from":if(null==n.event||null==n.data)return;return t.emit(n.event,n.data);case"peer_left":return t.emit("left"),t.channel.removeListener("message",o);case"peer_status":return t.status=n.status,t.emit("new_status",t.status)}}}(this),this.channel.on("message",o)}return o(n,t),n.prototype.send=function(t,n){return null==n&&(n={}),this.channel.send({type:"to",peer:this.peer_id,event:t,data:n})},n}(r),e.MucSignaling=function(t){function r(t,r){var o;this.channel=t,this.status=r,o=new n,this.join_p=o.promise,this.channel.on("closed",function(t){return function(){return t.emit("closed")}}(this)),this.channel.on("message",function(t){return function(n){var r,i,s,c;if(null!=n.type)switch(n.type){case"joined":if(null==n.peers)return;s=n.peers;for(i in s)c=s[i],r=new e.MucSignalingPeer(t.channel,i,c,!1),t.emit("peer_joined",r);return o.resolve();case"peer_joined":if(null==n.peer)return;return r=new e.MucSignalingPeer(t.channel,n.peer,n.status,!0),t.emit("peer_joined",r)}}}(this))}return o(r,t),r.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=this.channel.connect().then(function(t){return function(){return t.channel.send({type:"join",status:t.status})}}(this)).then(function(t){return function(){return t.join_d}}(this))),this.connect_p},r.prototype.setStatus=function(t){return this.status=t,this.connect_p?this.connect_p.then(function(){return this.channel.send({type:"status",status:t})}):void 0},r.prototype.leave=function(){return this.channel.send({type:"leave"}).then(function(){return this.channel.close()})},r}(r)}).call(this)},{"../internal/promise":4,events:void 0}],13:[function(t,n,e){(function(){var n,r,o=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;n=t("../internal/promise").Deferred,r=t("events").EventEmitter,e.PalavaSignalingPeer=function(t){function n(t,n,e,r){var o;this.channel=t,this.id=n,this.status=e,this.first=r,o=function(t){return function(n){return n.sender_id===t.id?null==n.event?void t.send("error","Invalid message"):t.emit(n.event,n.data):void 0}}(this),this.channel.on("message",o),this.on("peer_updated_status",function(t){return function(n){return t.emit("new_status",n)}}(this)),this.on("peer_left",function(t){return function(){return t.emit("closed"),t.channel.removeListener("message",o)}}(this))}return o(n,t),n.prototype.send=function(t,n){return null==n&&(n={}),this.channel.send({event:"send_to_peer",peer_id:this.id,data:{event:t,data:n}})},n}(r),e.PalavaSignaling=function(t){function r(t,r,o){var i;this.channel=t,this.room=r,this.status=o,this.peers={},this.joined=!1,i=new n,this.join_p=i.promise,this.channel.on("closed",function(t){return function(){return t.emit("closed")}}(this)),this.channel.on("message",function(t){return function(n){var r,o,s;if(null!=n.event)switch(n.event){case"joined_room":if(null==n.peers||null==n.own_id)return;s=n.peers;for(r in s)n=s[r],o=new e.PalavaSignalingPeer(t.channel,n.peer_id,n.status,!1),t.peers[n.peer_id]=o,t.emit("peer_joined",o);return i.resolve();case"new_peer":if(null==n.peer_id)return;return o=new e.PalavaSignalingPeer(t.channel,n.peer_id,n.status,!0),t.peers[n.peer]=o,t.emit("peer_joined",o)}}}(this))}return o(r,t),r.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=this.channel.connect().then(function(t){return function(){return t.channel.send({event:"join_room",room_id:room,status:status})}}(this))),this.connect_p},r.prototype.set_status=function(t){return this.channel.send({event:"update_status",status:t})},r.prototype.leave=function(){return this.channel.close()},r}(r)}).call(this)},{"../internal/promise":4,events:void 0}],14:[function(t,n,e){(function(){var n,r,o=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},i={}.hasOwnProperty;r=t("../internal/promise").Promise,n=t("events").EventEmitter,e.WebSocketChannel=function(t){function n(t){this.address=t}return o(n,t),n.prototype.connect=function(){return null==this.connect_p&&(this.connect_p=new r(function(t){return function(n,e){var r;return r=new WebSocket(t.address),r.onopen=function(){return t.socket=r,n()},r.onerror=function(n){return delete t.socket,t.emit("error",n),e(new Error("Unable to connect to socket"))},r.onmessage=function(n){var e;try{e=JSON.parse(n.data)}catch(r){return void t.emit("error","Unable to parse incoming message")}return t.emit("message",e)},r.onclose=function(){return t.emit("closed")}}}(this))),this.connect_p},n.prototype.send=function(t){var n;if(null==this.socket)return r.reject(new Error("Trying to send on WebSocket without being connected"));try{return this.socket.send(JSON.stringify(t)),r.resolve()}catch(e){return n=e,r.reject(n)}},n.prototype.close=function(){var t;if(null==this.socket)return r.reject(new Error("Trying to close WebSocket without being connected"));try{return this.socket.close(),r.resolve()}catch(n){return t=n,r.reject(t)}},n}(n)}).call(this)},{"../internal/promise":4,events:void 0}],15:[function(t,n,e){(function(){var n;n=t("./compat").compat,e.Stream=function(){function t(t){this.stream=t}return t.prototype.id=function(){return this.stream.id},t.prototype.hasTracks=function(t){return this.getTracks(t).length},t.prototype.getTracks=function(t){if(t=t.toLowerCase(),"audio"===t)return this.stream_p.then(function(t){return t.getAudioTracks()});if("video"===t)return this.stream_p.then(function(t){return t.getVideoTracks()});if("both"===t)return this.stream_p.then(function(t){var n,e;return e=t.getVideoTracks(),n=t.getAudioTracks(),e.concat(audio)});throw new Error("Invalid stream part '"+t+"'")},t.prototype.mute=function(t,n){var e,r,o,i;for(null==t&&(t=!0),null==n&&(n="audio"),o=getTracks(n),e=0,r=o.length;r>e;e++)i=o[e],i.enabled=!t;return t},t.prototype.toggleMute=function(t){var n,e,r,o,i,s;for(null==t&&(t="audio"),s=getTracks(t),r=!(null!=(o=s[0])?o.enabled:void 0),n=0,e=s.length;e>n;n++)i=s[n],i.enabled=!r;return r},t.prototype.stop=function(){return stream.stop()},t.createStream=function(e){return null==e&&(e={audio:!0,video:!0}),new Promise(function(r,o){var i;return i=function(n){return r(new t(n))},n.getUserMedia(e,i,o)})},t}()}).call(this)},{"./compat":1}],16:[function(t,n,e){(function(){var n,r;r=t("./stream").Stream,n=t("./peer").Peer,e.MediaDomElement=function(){function t(t,n){this.dom=t,null!=this.dom.jquery&&(this.dom=this.dom[0]),this.attach(n)}return t.prototype.attach=function(t){return null==t?(delete this.stream,this.dom.pause(),this.dom.src=null):t instanceof r?(this.stream=t,"undefined"!=typeof mozGetUserMedia&&null!==mozGetUserMedia?this.dom.mozSrcObject=t.stream:this.dom.src=URL.createObjectURL(t.stream),this.dom.play()):t instanceof n?this.attach(t.stream()):null!=(null!=t?t.then:void 0)?t.then(function(t){return function(n){return t.attach(n)}}(this))["catch"](function(t){return function(n){return t.error(n)}}(this)):this.error("Tried to attach invalid data")},t.prototype.error=function(t){return console.log(t)},t.prototype.clear=function(){return this.attach()},t.prototype.mute=function(t){return null==t&&(t=!0),this.dom.muted=t},t.prototype.toggleMute=function(){return this.dom.muted=!this.dom.muted},t}()}).call(this)},{"./peer":8,"./stream":15}]},{},[6])(6)});